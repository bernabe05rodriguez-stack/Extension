var customer_email,expiry_date,csv_data=[],csv_name="",my_number=null,plan_duration="",plan_type="Advance",last_plan_type="Expired",popup_numbers="";let translatedSendObj,translatedGroupMsgObj,translatedCustomObj,translatedAttachments,translatedContactMsgObj,currentLanguage="es",allLanguageCodes=ALL_LANGUAGE_CODES,libphone=null,country_info="",allGroups=[],allContacts=[],allLabels=[],groups_selected=[],contacts_selected=[],labels_selected=[],messageToggleSwitchValue="numbers",isMultipleAccount=!0,otherNumbers=null,parentEmail="",showAllMultNumbers=!0,subscribed_date=null,chatbotRules=[],chatbotRepliesSent=0,attachment_obj=!1,group_obj=!1,customization_obj=!1,isTourRunning=!1,is_excel_uploaded=!1,lastScrollPosition=0,lastScrollPosition_contacts=0,selectedAll=!1,fetching=!1,freeTrial6MonthsExpired=!1,freeTrial3MonthsExpired=!1,freeTrialDuration1=90,freeTrialDuration2=90,freeTrialLimit1=1e3,freeTrialLimit2=1e3,showFreeTrialLimitMessage=!0,autodownloadCampaignReport=!1,isMac=navigator.platform.toLowerCase().includes("mac"),isLinux=navigator.platform.toLowerCase().includes("linux"),location_info={name:"international",name_code:"US",currency:"USD",default:!0};async function convertPriceToLocale(price){const res=await fetch("https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json"),jsonData=await res.json();let{currency}=location_info,formatter=new Intl.NumberFormat("en-US",{style:"currency",currency,maximumFractionDigits:0}),exchangeRate=jsonData.usd[currency.toLowerCase()];return formatter.format(Math.round(1.02*exchangeRate*parseFloat(price)))}async function multipleAccountButton(){let{name:country_name,name_code:country_code,currency:country_currency}=location_info;return country_name=Object.keys(COUNTRY_WITH_SPECIFIC_PRICING).includes(country_code)?COUNTRY_WITH_SPECIFIC_PRICING[country_code]:"international",`<a href="<a href="" target="_blank" class="popup-btn pricing-purple-btn CtaBtn">\n        <span style="white-space:nowrap;">Buy multiple users<br/></span>\n        <span style="white-space:nowrap; color: #fff; font-size: 14px; line-height: 16px;font-weight:bold;display:flex;"><span style="margin-right:3px;">@</span>\n            ${"india"===country_name?'<span class="rupee">‚Çπ</span>':""}\n            <span class="price_class">${MULT25ACCOUNTPRICE[country_name]}</span>/month\n        </span>\n        ${"international"===country_name&&"USD"!=country_currency?`<span style="white-space:nowrap; color: #fff; font-size: 12px; line-height: 16px;font-weight:bold;"> \n(~<span class="price_class">${await convertPriceToLocale(MULT25ACCOUNTPRICE[country_name].substring(1))}</span>/month)\n</span>`:""}\n    </a>`}async function basicButton(pricing_link="",basicPrice="",basicConvertedPrice=""){let{name:country_name,name_code:country_code,currency:country_currency}=location_info;country_name=Object.keys(COUNTRY_WITH_SPECIFIC_PRICING).includes(country_code)?COUNTRY_WITH_SPECIFIC_PRICING[country_code]:"international";let converted_price=basicConvertedPrice;return basicConvertedPrice&&""!=basicConvertedPrice||(converted_price=await convertPriceToLocale(basicPrice.substring(1))),`<a href="${pricing_link}" target="_blank" class="popup-btn pricing-white-btn CtaBtn" style="font-weight:bold;font-size:14px;">\n        Buy Basic<br/>\n        <span style="white-space:nowrap; color: #009a88; font-size: 14px; line-height: 16px;font-weight:bold;display:flex;"><span style="margin-right:3px;">@</span> \n            ${"india"===country_name?'<span class="rupee">‚Çπ</span>':""}\n            <span class="price_class">${basicPrice}</span>/month\n        </span>\n        ${"international"===country_name&&"USD"!=country_currency?`<span style="white-space:nowrap; color: #009a88; font-size: 12px; line-height: 16px;font-weight:bold;">\n(~<span class="price_class">${converted_price}</span>/month)\n</span>`:""}\n    </a>`}async function advanceButton(pricing_link="",advancePrice="",advanceConvertedPrice="",popup_name,showPrice=!0){let{name:country_name,name_code:country_code,currency:country_currency}=location_info;country_name=Object.keys(COUNTRY_WITH_SPECIFIC_PRICING).includes(country_code)?COUNTRY_WITH_SPECIFIC_PRICING[country_code]:"international";let converted_price=advanceConvertedPrice;return advanceConvertedPrice&&""!=advanceConvertedPrice||(converted_price=await convertPriceToLocale(advancePrice.substring(1))),"free_trial_start"!=popup_name&&"free_trial_reminder"!=popup_name&&"free_trial_expired"!=popup_name&&"AdvancePromo"!=last_plan_type&&"advance_promo_activated"!=popup_name&&"advance_promo_reminder"!=popup_name&&"advance_promo_expired"!=popup_name||(pricing_link=""),`<a href="${pricing_link}" target="_blank" class="popup-btn pricing-green-btn CtaBtn" style="font-weight:bold;font-size:14px;">\n        Buy Advance\n        ${showPrice?`<br/>\n            <span style="white-space:nowrap; font-size: 14px; line-height: 16px;font-weight:bold;display:flex;"><span style="margin-right:3px;">@</span>\n                ${"india"===country_name?'<span class="rupee">‚Çπ</span>':""}\n                <span class="price_class">${advancePrice}</span>/month\n            </span>\n            ${"international"===country_name&&"USD"!=country_currency?`<span style="white-space:nowrap; color: #009a88; font-size: 12px; line-height: 16px;font-weight:bold;"> \n    (~<span class="price_class">${converted_price}</span>/month)\n    </span>`:""}`:""}\n    </a>`}async function fetchTranslations(obj){const translatedObj=JSON.parse(JSON.stringify(obj));for(const step of translatedObj.steps)step.popover&&(step.popover.title=await translate(step.popover.title),step.popover.description=await translate(step.popover.description));return translatedObj}function handleMoreButtons(){const buttonContainer=$("#tours"),buttons=buttonContainer.find(".attachment-instructions-btn");if(buttons.length>3){buttons.slice(3).hide();const moreButton=$('<button class="attachment-instructions-btn more-btn"><span class="attachment-instructions-text attachment-instructions CtaBtn">...more</span></button>');buttonContainer.append(moreButton),moreButton.on("click",function(){buttons.slice(3).addClass("active-class"),moreButton.remove()})}}function handleAutoDownloadCampaignReport(){chrome.storage.local.get(["autodownloadCampaignReport"],function(res){null!=res.autodownloadCampaignReport&&null!=res.autodownloadCampaignReport&&0!=res.autodownloadCampaignReport||(autodownloadCampaignReport=!1);const autoDownloadReportInput=document.getElementById("auto_download_campaign_report");autodownloadCampaignReport&&(autoDownloadReportInput.checked=!0),chrome.storage.local.set({autodownloadCampaignReport}),autoDownloadReportInput.addEventListener("change",function(){autodownloadCampaignReport=autoDownloadReportInput.checked,chrome.storage.local.set({autodownloadCampaignReport})})})}function initializeRandomCustomFeature(){const randomCustomContainer=document.getElementById("random_custom_container"),randomCustomRadio=document.getElementById("random_custom");document.getElementById("custom_range_inputs");randomCustomContainer&&randomCustomRadio&&(randomCustomRadio.disabled=!1,randomCustomContainer.style.opacity="1",randomCustomContainer.style.cursor="pointer")}function showCustomizeContainer(){const message_box=document.querySelector(".message-box"),customize_container=document.querySelector(".customize_container"),attachment_instructions_container=document.querySelector(".message-box .attachment-instruction-secondary");message_box&&(message_box.style.marginBottom="0px",message_box.style.borderRadius="3px 3px 0px 0px"),attachment_instructions_container&&(attachment_instructions_container.hidden="true"),customize_container&&(customize_container.style.display="flex")}function hideCustomizationContainer(){const message_box=document.querySelector(".message-box"),customize_container=document.querySelector(".customize_container"),caption_customize_container=document.querySelector(".caption_customize_container"),attachment_instructions_container=document.querySelector(".message-box .attachment-instruction-secondary");message_box&&(message_box.style.marginBottom="10px",message_box.style.borderRadius="3px"),attachment_instructions_container&&(attachment_instructions_container.hidden=!1),customize_container&&(customize_container.style.display="none"),caption_customize_container&&(caption_customize_container.style.display="none"),showCaptionCustomizationContainer(!1)}function populateCustomizeData(){column_headers=csv_data[0];const customize_section=document.querySelector(".customize_section"),caption_customize_section=document.querySelector(".caption_customize_section");if(customize_section){customize_section.innerHTML="";let customizeHtml='\n            <div class="customize_heading">Customizations: </div>\n        ';column_headers.forEach((header,index)=>{customizeHtml+=`<div class="customize_box CtaBtn">${header}</div>`}),customize_section.innerHTML=customizeHtml;document.querySelectorAll(".customize_box").forEach((box,index)=>{box.addEventListener("click",event=>{var message=document.querySelector("textarea#message").value;message+=" {{"+event.target.innerText+"}}",document.querySelector("textarea#message").value=message,chrome.storage.local.set({popup_message:message})})})}if(caption_customize_section){caption_customize_section.innerHTML="";let customizeHtml='\n            <div class="customize_heading">Customizations: </div>\n        ';column_headers.forEach((header,index)=>{customizeHtml+=`<div class="caption_customize_box CtaBtn">${header}</div>`}),caption_customize_section.innerHTML=customizeHtml;document.querySelectorAll(".caption_customize_box").forEach((box,index)=>{box.addEventListener("click",async event=>{let captionForIndividualAttachment=await new Promise(resolve=>{chrome.storage.local.get(["captionForIndividualAttachment"],res=>{resolve(res.captionForIndividualAttachment||[])})});document.querySelectorAll(".caption-input").forEach(ele=>{if(!ele.classList.contains("hide")){var eleId=ele.id.substring(ele.id.search(/\d/));return ele.value+=" {{"+event.target.innerText+"}}",captionForIndividualAttachment[eleId]=ele.value,void chrome.storage.local.set({captionForIndividualAttachment})}})})})}}function showCaptionCustomizationContainer(showConatiner){const captionCustomizationContainer=document.querySelector(".caption_customize_container");captionCustomizationContainer&&(captionCustomizationContainer.style.display=showConatiner?"flex":"none")}async function toggleCaptionCustomizationInputDiv(){const captionCustomizationInputDiv=document.querySelector(".caption_customization_input_div");let internal_csv_data=await new Promise(resolve=>{chrome.storage.local.get(["csv_data"],res=>{resolve(res.csv_data||[])})});captionCustomizationInputDiv&&(internal_csv_data.length>0?showCaptionCustomizationContainer(!0):showCaptionCustomizationContainer(!1))}function renderItems({name,objId,serizalizeId,isFirst=!1,isGroup=!0,isLabel=!1}){const displayBox=document.querySelector(".groups_display_box");let selectedArray=isGroup?groups_selected:contacts_selected,htmlContent=displayBox.innerHTML;(selectedArray.length<=1||isFirst)&&(htmlContent=""),htmlContent+=`<span class="group_tag CtaBtn" id=${objId} data-id-field=${serizalizeId}>\n            <span class="group">${name}</span>\n            <img class="delete_group_tag" src="./logo/pro-closeBtn.png" title="Remove ${isGroup?"Group":"Contact"}">\n        </span>`,displayBox.innerHTML=htmlContent}function showItems(isGroup=!0,isLabel=!1){const itemsContainer=document.querySelector("#groups_container");itemsContainer.innerHTML="";const selectedArray=isGroup?groups_selected:contacts_selected,allItems=isGroup?allGroups:allContacts,containerHtml=allItems.filter(item=>!selectedArray.includes(item.id._serialized)).map(item=>`\n            <div class="dropdown-item" id="${item.objId}" data-id-field="${item.id._serialized}">\n                ${item.name}\n            </div>\n        `).join("");itemsContainer.innerHTML=containerHtml;document.querySelector(".search_group_input").addEventListener("input",function(){const inputValue=this.value.toLowerCase();allItems.forEach(item=>{const itemElement=document.querySelector(`#groups_container #${item.objId}`);if(!itemElement)return void console.warn(`Element with id "${item.objId}" not found.`);const isMatch=item.name?.toLowerCase().includes(inputValue),isSelected=selectedArray.includes(item.id._serialized);isMatch&&!isSelected?itemElement.classList.remove("hide"):itemElement.classList.add("hide")})}),document.querySelectorAll("#groups_container .dropdown-item").forEach(listItem=>{listItem.addEventListener("click",function(){const objId=this.id,name=this.innerText,serizalizeId=this.getAttribute("data-id-field");selectedArray.includes(serizalizeId)||(selectedArray.push(serizalizeId),chrome.storage.local.set({[isGroup?"groups_selected":"contacts_selected"]:selectedArray}),renderItems({name,objId,serizalizeId,isGroup}),listItem.classList.add("hide")),0===itemsContainer.clientHeight&&document.querySelector(".groups_searchbar").click(),handleDeleteBin(),showGroupsCampaignSelectorOrSave()})})}async function handleSelectAll(){const listItems=document.querySelectorAll("#groups_container .dropdown-item"),listItemContainer=document.querySelector("#groups_container");let isGroup="groups"===messageToggleSwitchValue,allItems=isGroup?allGroups:allContacts;if((isGroup?groups_selected:contacts_selected).length===allItems.length){let msg=await translate(`All ${messageToggleSwitchValue} are selected`);return void alert(msg)}if(listItemContainer.classList.contains("hide"))fetching=!0,isGroup?(groups_selected=allGroups.map(item=>item.id._serialized),chrome.storage.local.set({groups_selected}),selectedAll=!0):(contacts_selected=allContacts.map(item=>item.id._serialized),chrome.storage.local.set({contacts_selected}),selectedAll=!0);else{let updatedSelectedArray=Array.from(listItems).filter(item=>!item.classList.contains("hide")).map(item=>item.getAttribute("data-id-field"));isGroup?(groups_selected=[...new Set([...groups_selected,...updatedSelectedArray])],chrome.storage.local.set({groups_selected})):(contacts_selected=[...new Set([...contacts_selected,...updatedSelectedArray])],chrome.storage.local.set({contacts_selected})),listItemContainer.classList.add("hide"),document.querySelector(".message-box").classList.remove("hide_visibility")}renderSelectedItems()}function openChatbotModal(){document.getElementById("chatbot_modal_popup").style.display="block"}function closeChatbotModal(){document.getElementById("chatbot_modal_popup").style.display="none"}chrome.windows.getCurrent().then(window=>{"fullscreen"===window.state&&isMac&&chrome.windows.update(window.id,{state:"normal"})}),$(function(){init()}),window.addEventListener("DOMContentLoaded",event=>{handleMoreButtons(),handleDeleteBin(),handleShowTooltip(),getNextTour((nextTour,index)=>{nextTour&&highlightTour(nextTour,index)}),document.querySelector("#schedule_day").valueAsDate=new Date;let time=getCurrentTimein24HourFormat();setTimeout(()=>{document.querySelector("input#schedule_time").value=time},100),document.querySelectorAll('input[name="message_type"]').forEach(radio=>{radio.addEventListener("change",()=>{toggleSendMessageToInput(document.querySelector('input[name="message_type"]:checked').value)})}),handleAutoDownloadCampaignReport(),initializeRandomCustomFeature()}),window.addEventListener("focus",()=>{initializeRandomCustomFeature()});let editingRuleId=null;function renderChatbotRules(){const rulesList=document.getElementById("chatbot_rules_list");if(!rulesList)return;if(0===chatbotRules.length)return rulesList.innerHTML='<div class="chatbot_empty_state"><div class="chatbot_empty_state_icon">ü§ñ</div><div data-translate-text>No rules added yet</div></div>',void updateChatbotStats();let rulesHTML="";chatbotRules.forEach(rule=>{rulesHTML+=`\n    <div class="chatbot_rule_item" data-rule-id="${rule.id}">\n      <div class="chatbot_rule_content">\n        <div class="chatbot_rule_keyword">üìå ${rule.keyword}</div>\n        <div class="chatbot_rule_response">${rule.response}</div>\n        <div class="chatbot_rule_options">\n          ${rule.caseSensitive?"<span>üî§ Case Sensitive</span>":""}\n          ${rule.exactMatch?"<span>‚úì Exact Match</span>":""}\n        </div>\n      </div>\n      <div class="chatbot_rule_actions">\n        <button class="chatbot_rule_btn chatbot_rule_edit" title="Edit rule">‚úèÔ∏è Edit</button>\n        <button class="chatbot_rule_btn chatbot_rule_delete" title="Delete rule"><img src="logo/pro-delete-icon.png" alt="Delete" class="chatbot_delete_icon"></button>\n      </div>\n    </div>`}),rulesList.innerHTML='<div style="padding: 12px;">'+rulesHTML+"</div>";rulesList.querySelectorAll(".chatbot_rule_delete").forEach(btn=>{btn.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();deleteChatbotRule(this.closest(".chatbot_rule_item").getAttribute("data-rule-id"))})});rulesList.querySelectorAll(".chatbot_rule_edit").forEach(btn=>{btn.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();startEditChatbotRule(this.closest(".chatbot_rule_item").getAttribute("data-rule-id"))})}),updateChatbotStats()}function updateChatbotStats(){const totalRulesEl=document.getElementById("chatbot_total_rules"),repliesSentEl=document.getElementById("chatbot_replies_sent");totalRulesEl&&(totalRulesEl.textContent=chatbotRules.length),repliesSentEl&&(repliesSentEl.textContent=chatbotRepliesSent||0)}function startEditChatbotRule(ruleId){const rule=chatbotRules.find(r=>r.id===ruleId);rule&&(editingRuleId=ruleId,document.getElementById("chatbot_keyword_input").value=rule.keyword,document.getElementById("chatbot_response_input").value=rule.response,document.getElementById("chatbot_case_sensitive").checked=!!rule.caseSensitive,document.getElementById("chatbot_exact_match").checked=!!rule.exactMatch,document.getElementById("chatbot_add_rule_btn").style.display="none",document.getElementById("chatbot_update_rule_btn").style.display="block",document.getElementById("chatbot_cancel_edit_btn").style.display="block")}function updateChatbotRule(){if(!editingRuleId)return;const keyword=document.getElementById("chatbot_keyword_input").value.trim(),response=document.getElementById("chatbot_response_input").value.trim(),caseSensitive=document.getElementById("chatbot_case_sensitive").checked,exactMatch=document.getElementById("chatbot_exact_match").checked;if(!keyword||!response)return void alert("Please fill in both keyword and response");let updated=!1;chatbotRules=chatbotRules.map(rule=>rule.id===editingRuleId?(updated=!0,{...rule,keyword,response,caseSensitive,exactMatch}):rule),updated&&(chrome.storage.local.set({chatbotSettings:{enabled:document.querySelector("#chatbot_enabled").checked,rules:chatbotRules,repliesSent:chatbotRepliesSent}}),renderChatbotRules(),updateChatbotStats(),resetChatbotRuleForm())}function cancelEditChatbotRule(){resetChatbotRuleForm()}function resetChatbotRuleForm(){editingRuleId=null,document.getElementById("chatbot_keyword_input").value="",document.getElementById("chatbot_response_input").value="",document.getElementById("chatbot_case_sensitive").checked=!1,document.getElementById("chatbot_exact_match").checked=!1,document.getElementById("chatbot_add_rule_btn").style.display="block",document.getElementById("chatbot_update_rule_btn").style.display="none",document.getElementById("chatbot_cancel_edit_btn").style.display="none"}function addChatbotRule(){const keyword=document.getElementById("chatbot_keyword_input").value.trim(),response=document.getElementById("chatbot_response_input").value.trim(),caseSensitive=document.getElementById("chatbot_case_sensitive").checked,exactMatch=document.getElementById("chatbot_exact_match").checked;if(!keyword||!response)return void alert("Please fill in both keyword and response");if(keyword.length>100)return void alert("Keyword must be less than 100 characters");if(response.length>500)return void alert("Response must be less than 500 characters");const rule={id:"rule_"+Date.now(),keyword,response,caseSensitive,exactMatch,createdAt:(new Date).toISOString()};chatbotRules.push(rule);const chatbotSettings={enabled:document.querySelector("#chatbot_enabled").checked,rules:chatbotRules,repliesSent:chatbotRepliesSent};chrome.storage.local.set({chatbotSettings}),document.getElementById("chatbot_keyword_input").value="",document.getElementById("chatbot_response_input").value="",document.getElementById("chatbot_case_sensitive").checked=!1,document.getElementById("chatbot_exact_match").checked=!1,renderChatbotRules(),updateChatbotStats()}function deleteChatbotRule(ruleId){if(confirm("Are you sure you want to delete this rule?")){const initialLength=chatbotRules.length;chatbotRules=chatbotRules.filter(r=>r.id!==ruleId);if(initialLength===chatbotRules.length)return;const chatbotSettings={enabled:document.querySelector("#chatbot_enabled").checked,rules:chatbotRules,repliesSent:chatbotRepliesSent};chrome.storage.local.set({chatbotSettings}),renderChatbotRules(),updateChatbotStats()}else console.log("‚ùå User cancelled deletion")}function initvars(){document.getElementById("time_gap_type").style.display="none",chrome.storage.local.get(["popup_message","show_advance_options","time_gap","time_gap_checked","time_gap_type","time_gap_from","time_gap_to","batch_checked","batch_size","batch_gap","file_name","csv_data","customization","schedule_time","my_number","plan_type","last_plan_type","plan_duration","customer_name","customer_email","premiumUsageObject","countOfDaysTranslateUsed","lastDaySinceTranslateUsed","attachmentShimmerLastShowed","countOfDaysAttachmentShimmerShown","pausedCampaign","allGroupData","allContactData","allLabelData","groups_selected","contacts_selected","labels_selected","send_messages_to","resumeCampaign","subscribed_date","linuxInputAttachments","linuxCSVAttachment","location_info","currentLanguage","pausedCampaignsList","expiry_date","chatbotSettings","addUniqueIdentifier"],function(result){if(result.currentLanguage&&(currentLanguage=result.currentLanguage),void 0!==result.plan_type&&(plan_type=result.plan_type),void 0!==result.plan_duration&&(plan_duration=result.plan_duration),void 0!==result.expiry_date&&(expiry_date=result.expiry_date),void 0!==result.last_plan_type&&(last_plan_type=result.last_plan_type),result.chatbotSettings){const isEnabled=result.chatbotSettings.enabled||!1;isEnabled&&!isAdvanceFeatureAvailable()?(document.querySelector("#chatbot_enabled").checked=!1,document.getElementById("chatbot_settings_btn").style.display="none"):(document.querySelector("#chatbot_enabled").checked=isEnabled,document.getElementById("chatbot_settings_btn").style.display=isEnabled?"block":"none"),result.chatbotSettings.rules&&result.chatbotSettings.rules.length>0?(chatbotRules=result.chatbotSettings.rules,"function"==typeof renderChatbotRules&&renderChatbotRules(),"function"==typeof updateChatbotStats&&updateChatbotStats()):"function"==typeof updateChatbotStats&&updateChatbotStats(),result.chatbotSettings.repliesSent&&(chatbotRepliesSent=result.chatbotSettings.repliesSent)}else document.querySelector("#chatbot_enabled").checked=!1,document.getElementById("chatbot_settings_btn").style.display="none";if(void 0!==result.addUniqueIdentifier?result.addUniqueIdentifier&&!isPremiumFeatureAvailable()?document.querySelector("#addUniqueIdentifier").checked=!1:document.querySelector("#addUniqueIdentifier").checked=result.addUniqueIdentifier:document.querySelector("#addUniqueIdentifier").checked=!1,void 0!==result.popup_message&&(document.querySelector("textarea#message").value=result.popup_message),void 0!==result.schedule_time&&(document.querySelector("#schedule_time").value=result.schedule_time),result.allGroupData&&(allGroups=result.allGroupData),result.allContactData&&(allContacts=result.allContactData),result.allLabelData&&(allLabels=result.allLabelData),result.labels_selected&&(labels_selected=result.labels_selected),result.subscribed_date&&(subscribed_date=result.subscribed_date),void 0!==result.file_name&&""!==result.file_name&&(is_excel_uploaded=!0,set_csv_styles(result.file_name),showCustomizeContainer(),csv_data=result.csv_data)){csv_data[0];populateCustomizeData()}if((my_number=void 0===result.my_number?null:result.my_number)?trackSystemEvent("my_number_popup",my_number):(document.getElementById("add_number_popup").style.display="block",trackButtonView("add_number_popup"),trackSystemEvent("no_number_popup","track")),location_info=result.location_info||location_info,void 0!==result.customer_email&&(customer_email=result.customer_email),loadScheduledCampaigns(result.scheduled_campaigns),scheduleExpiredPopup(),isPremium()){if(document.querySelector(".premium_feature_block").style.display="flex",result.customer_name){let customer_first_name=result.customer_name.trim().split(" ")[0];document.getElementById("user_info_text").innerHTML=`<div class='premium_username' style="font-weight: 700; display: inline; word-break: break-word;">${customer_first_name}</div> - <div style="display: inline; font-weight: 500;" class="premium_user_plan_type">${plan_type} Premium</div>`}else document.getElementById("user_info_text").innerHTML=`<div style="display: inline; font-weight: 500; margin-left:10px" class="premium_user_plan_type">${plan_type} Premium</div>`;document.getElementById("add_business_img").src="logo/pro-user-1.png",document.getElementById("premium_support_block").style.display="block",document.getElementById("non_premium_header_text").style.display="none",document.getElementById("user_info_text").style.display="block"}else document.getElementById("premium_support_block").style.display="none",document.getElementById("user_info_text").style.display="none",document.getElementById("non_premium_header_text").style.display="block",document.getElementById("non_premium_header_text").innerText=getNonPremiumHeaderText();if(isAdvancePromo()?document.querySelector(".what_is_advancepromo_block").style.display="block":document.querySelector(".what_is_advancepromo_block").style.display="none",isPremiumFeatureAvailable()){if(result.time_gap_checked&&(document.querySelector("#time_gap_checked").checked=result.time_gap_checked,document.getElementById("time_gap_type").style.display="flex",result.time_gap_type&&(document.querySelector("#"+result.time_gap_type).checked=!0),"random"==result.time_gap_type?disableNumberTimeGapInput("sec"):"random_custom"==result.time_gap_type?disableNumberTimeGapInput("random_custom"):disableNumberTimeGapInput("random")),result.time_gap){if((values=[1,2,3,4,5,6,7,8,9,10,15,20]).includes(parseInt(result.time_gap))){const index=values.indexOf(parseInt(result.time_gap));document.querySelector("#slider_time_gap_sec").value=index}else result.time_gap>20?document.querySelector("#slider_time_gap_sec").value=values.length-1:0==result.time_gap&&(document.querySelector("#slider_time_gap_sec").value=3);document.querySelector("#time_gap_sec").value=result.time_gap}const defaultFromValue=isAdvanceFeatureAvailable()?3:30,defaultToValue=isAdvanceFeatureAvailable()?10:40;if(result.time_gap_from?document.querySelector("#time_gap_from").value=result.time_gap_from:document.querySelector("#time_gap_from").value=defaultFromValue,result.time_gap_to?document.querySelector("#time_gap_to").value=result.time_gap_to:document.querySelector("#time_gap_to").value=defaultToValue,setupRandomCustomRadioHandler(),result.batch_checked&&(document.querySelector("#batch_checked").checked=result.batch_checked,document.getElementById("batch_info").style.display="grid"),result.batch_size){if((values=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50]).includes(parseInt(result.batch_size))){const index=values.indexOf(parseInt(result.batch_size));document.querySelector("#slider_batch_size").value=index}else(result.batch_size>50||0==result.batch_gap)&&(document.querySelector("#slider_batch_size").value=values.length-1);document.querySelector("#batch_size").value=result.batch_size}if(result.batch_gap){var values;if((values=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50]).includes(parseInt(result.batch_gap))){const index=values.indexOf(parseInt(result.batch_gap));document.querySelector("#slider_batch_gap").value=index}else result.batch_gap>50?document.querySelector("#slider_batch_gap").value=values.length-1:0==result.batch_gap&&(document.querySelector("#slider_batch_gap").value=13);document.querySelector("#batch_gap").value=result.batch_gap}}else result.time_gap_checked&&(document.querySelector("#time_gap_checked").checked=result.time_gap_checked,document.getElementById("time_gap_type").style.display="flex"),document.querySelector("#sec").checked=!0,disableNumberTimeGapInput("random"),document.querySelector("#time_gap_sec").value=30;if(result.my_number&&result.my_number.startsWith(62)&&!isPremium()&&(document.getElementById("live_support_text").hidden=!0,document.getElementById("email_support_text").hidden=!1),result.groups_selected&&(groups_selected=result.groups_selected),result.contacts_selected&&(contacts_selected=result.contacts_selected),result.send_messages_to&&("groups"==result.send_messages_to?(messageToggleSwitchValue="groups",document.querySelector("#message_type_groups").click()):"contacts"==result.send_messages_to?(messageToggleSwitchValue="contacts",document.querySelector("#message_type_contact").click()):"labels"==result.send_messages_to?(messageToggleSwitchValue="labels",document.querySelector("#message_type_label").click()):messageToggleSwitchValue="numbers",void 0!==result.popup_message&&(document.querySelector("#message").value=result.popup_message)),void 0!==result.premiumUsageObject){let updatedPremiumUsageObject={...result.premiumUsageObject};result.time_gap_checked&&(updatedPremiumUsageObject={...updatedPremiumUsageObject,timeGap:!0}),result.batch_checked&&(updatedPremiumUsageObject={...updatedPremiumUsageObject,batching:!0}),chrome.storage.local.set({premiumUsageObject:updatedPremiumUsageObject})}let today=(new Date).toDateString(),lastDay=result.lastDaySinceTranslateUsed||"",countDays=result.countOfDaysTranslateUsed||0;lastDay==today||countDays>5?($("#language-selector").removeClass("shimmer"),$("#customization-in-box").removeClass("shimmer"),$("#translate-icon").removeClass("shimmer")):(chrome.storage.local.set({countOfDaysTranslateUsed:countDays+1}),chrome.storage.local.set({lastDaySinceTranslateUsed:today}));const lastDayWhenAttachmentShimmerShown=result.attachmentShimmerLastShowed||"",countOfDaysAttachmentShimmerShown=result.countOfDaysAttachmentShimmerShown||0;if(lastDayWhenAttachmentShimmerShown==today||countOfDaysAttachmentShimmerShown>3?$("#add-attachments").removeClass("shimmer"):(chrome.storage.local.set({countOfDaysAttachmentShimmerShown:countOfDaysAttachmentShimmerShown+1}),chrome.storage.local.set({attachmentShimmerLastShowed:today})),document.querySelector("#schedule_selector").addEventListener("click",async function(e){chrome.storage.local.get(["scheduled_campaigns"],function(res){loadScheduledCampaigns(res.scheduled_campaigns||[]),$("#schedule_container").toggleClass("hide"),$("#schedule_selector").toggleClass("active")})}),result.pausedCampaign&&1==result.pausedCampaign.paused){let pausedCampaignsList=result.pausedCampaignsList;pausedCampaignsList||(pausedCampaignsList=[]);let pausedCampaignData=result.pausedCampaign;pausedCampaignsList.push({...pausedCampaignData,campaignDate:getTodayDate()}),result.pausedCampaignsList=pausedCampaignsList,result.pausedCampaign=null,chrome.storage.local.set({pausedCampaign:null}),chrome.storage.local.set({pausedCampaignsList})}if(result.resumeCampaign&&1==result.resumeCampaign.isCampaignRunning&&result.pausedCampaign){result.pausedCampaign.index=result.resumeCampaign.index;let pausedCampaignsList=result.pausedCampaignsList;pausedCampaignsList||(pausedCampaignsList=[]);let pausedCampaignData=result.pausedCampaign;pausedCampaignsList.push({...pausedCampaignData,campaignDate:getTodayDate()}),result.pausedCampaignsList=pausedCampaignsList,chrome.storage.local.set({pausedCampaign:null}),chrome.storage.local.set({pausedCampaignsList}),chrome.storage.local.set({resumeCampaign:{isCampaignRunning:!1,index:0}})}document.querySelector("#paused_campaign_selector").addEventListener("click",async function(e){chrome.storage.local.get(["pausedCampaignsList"],function(res){let newPausedCampaignsList=(res.pausedCampaignsList||[]).filter(campaign=>{let pausedDate=campaign.campaignDate;return dateDiffInDays(getTodayDate(),pausedDate)<=7});loadPausedCampaigns(newPausedCampaignsList),$("#paused_campaign_container").toggleClass("hide"),$("#paused_campaign_selector").toggleClass("active"),chrome.storage.local.set({pausedCampaignsList:newPausedCampaignsList})})}),result.linuxInputAttachments&&convertURLToFileAndFireChangeEvent("linuxInputAttachments","select-attachments",result.linuxInputAttachments),result.linuxCSVAttachment&&convertURLToFileAndFireChangeEvent("linuxCSVAttachment","csv",result.linuxCSVAttachment)})}function convertURLToFileAndFireChangeEvent(dataType,inputId,inputAttachments){const files=inputAttachments.map(fileData=>dataURLtoFile(fileData.data,fileData.name,fileData.type)),dataTransfer=new DataTransfer;files.forEach(file=>{dataTransfer.items.add(file)});const inputElement=document.getElementById(inputId);inputElement.files=dataTransfer.files;const event=new Event("change",{bubbles:!0});inputElement.dispatchEvent(event),chrome.storage.local.set({[dataType]:null})}function dataURLtoFile(dataurl,filename,mimeType){const arr=dataurl.split(","),mime=mimeType||arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]);let n=bstr.length;const u8arr=new Uint8Array(n);for(;n--;)u8arr[n]=bstr.charCodeAt(n);return new File([u8arr],filename,{type:mime})}function getNonPremiumHeaderText(){if(isAdvancePromo())return"AdvancePromo Enabled - Explore Features";if(!isExpired())return"Add Business Features - Buy Premium";switch(last_plan_type){case"FreeTrial":return"FreeTrial Expired - Buy Premium";case"AdvancePromo":return"AdvancePromo Expired - Buy Premium";case"Basic":return"Basic Plan Expired - Buy Again";case"Advance":return"Advance Plan Expired - Buy Again";default:return"Add Business Features - Buy Premium"}}function handlePausedCampaign(pausedCampaignData){if(!isAdvanceFeatureAvailable())return chrome.storage.local.set({pausedCampaign:null}),chrome.storage.local.set({pausedCampaignsList:null}),chrome.storage.local.set({resumeCampaign:{isCampaignRunning:!1,index:0}}),sendMessageToBackground({type:"show_advance_popup",feature:"resume_campaign"}),void window.close();const{numbers,message,time_gap,csv_data,customization,caption_customization,random_delay,batch_size,batch_gap,caption,custom_time_range}=pausedCampaignData.campaignData,campaign_type=pausedCampaignData.campaignData.campaign_type,startIndex=pausedCampaignData.index;chrome.storage.local.set({attachmentsData:pausedCampaignData.attachmentsData},function(){if(!checkIfCanSendCampaign(numbers.length))return sendMessageToBackground({type:"show_message_count_over_popup"}),void window.close();sendMessageToBackground("group_message"==campaign_type?{type:"group_message",groups:numbers,message,time_gap,csv_data,customization,caption_customization,random_delay,batch_size,batch_gap,caption,startIndex,paused_report_rows:pausedCampaignData.report_rows,paused_sent_count:pausedCampaignData.sent_count,campaign_type,custom_time_range}:{type:"number_message",numbers,message,time_gap,csv_data,customization,caption_customization,random_delay,batch_size,batch_gap,caption,startIndex,paused_report_rows:pausedCampaignData.report_rows,paused_sent_count:pausedCampaignData.sent_count,campaign_type,custom_time_range}),chrome.storage.local.set({pausedCampaign:null}),window.close()}),chrome.storage.local.set({resumeCampaign:{isCampaignRunning:!1,index:0}}),trackButtonClick("popupjs_resume_campaign")}async function loadPausedCampaigns(pausedCampaigns){if($("#paused_campaign_container").html(""),pausedCampaigns&&pausedCampaigns.length>0)for(let index=0;index<pausedCampaigns.length;index++){let campaignName=pausedCampaigns[index].campaign_name||"Campaign-"+Number(index+1),campaignDate=formatScheduleDate(pausedCampaigns[index].campaignDate);$("#paused_campaign_container").append(`\n                <div class="dropdown-item">\n                    <p id="paused_campaign_${index}" class="campaign_name text">\n                        <img src="./logo/pro-excel_icon.png"/>\n                        <span style="color: #009A88;">${campaignName}</span>\n                        <span style="color: #5D6063;">${campaignDate}</span>\n                    </p>\n                    <img id="${index}" class="paused_campaign_resume_btn btn CtaBtn" src="./logo/pro-resume_logo.png" style="margin-right:3px;"/>\n                    <img id="${index}" class="paused_campaign_delete_btn btn CtaBtn" src="./logo/pro-delete-icon.png" style="padding:4px 4px 4px 0;margin:0px;" />\n                </div>`)}else $("#paused_campaign_container").append(`<div class="dropdown-item">${await translate("No paused campaigns")}</div>`);$(".paused_campaign_resume_btn").click(function(){let index=$(this).attr("id");const newPausedCampaigns=pausedCampaigns.filter((campaign,i)=>i!=index);chrome.storage.local.set({pausedCampaignsList:newPausedCampaigns}),handlePausedCampaign(pausedCampaigns[index])}),$(".paused_campaign_delete_btn").click(function(){let index=$(this).attr("id");const newPausedCampaigns=pausedCampaigns.filter((campaign,i)=>i!=index);chrome.storage.local.set({pausedCampaignsList:newPausedCampaigns},function(res){loadPausedCampaigns(newPausedCampaigns)})})}function init(){document.getElementById("chatbot_update_rule_btn").addEventListener("click",updateChatbotRule),document.getElementById("chatbot_cancel_edit_btn").addEventListener("click",cancelEditChatbotRule),checkVisit(),initvars(),setListOrLabel(),getMessage(),loadConfigData(),sendMessageToBackground({type:"reload_contacts"}),"function"==typeof initChatbotUI&&initChatbotUI().catch(err=>console.error("‚ùå Error initializing chatbot:",err))}function setListOrLabel(){let favouriteOption=document.querySelector(".favourite_id"),labelOption=document.querySelector(".label_id");chrome.storage.local.get(["my_account_type"],res=>{my_account_type=res.my_account_type,"Normal"===my_account_type?(favouriteOption&&favouriteOption.classList.remove("hide"),labelOption&&labelOption.classList.add("hide")):(labelOption&&labelOption.classList.remove("hide"),favouriteOption&&favouriteOption.classList.add("hide"))})}function checkVisit(){chrome.storage.local.get(["no_of_visit"],function(res){let visit_count=res.no_of_visit||0;chrome.tabs.query({url:"*://web.whatsapp.com/*"},function(tabs){tabs.length>0?tabs[0].active||chrome.tabs.update(tabs[0].id,{active:!0}):chrome.tabs.create({url:"https://web.whatsapp.com"})}),chrome.storage.local.set({no_of_visit:visit_count+1}),trackSystemEvent("extension_visit",visit_count)})}function loadConfigData(){chrome.storage.local.get(["CONFIG_DATA"],res=>{res.CONFIG_DATA&&(res.CONFIG_DATA.ALL_LANGUAGE_CODES&&(allLanguageCodes=res.CONFIG_DATA.ALL_LANGUAGE_CODES),res.CONFIG_DATA.FAQS&&(FAQS=res.CONFIG_DATA.FAQS),res.CONFIG_DATA.FREE_TRIAL_LIMIT&&(FREE_TRIAL_LIMIT=res.CONFIG_DATA.FREE_TRIAL_LIMIT,showFreeTrialLimitMessage=FREE_TRIAL_LIMIT.showLimitMessage,freeTrialDuration1=FREE_TRIAL_LIMIT.duration1,freeTrialDuration2=FREE_TRIAL_LIMIT.duration2,freeTrialLimit1=FREE_TRIAL_LIMIT.limit1,freeTrialLimit2=FREE_TRIAL_LIMIT.limit2,freeTrialDuration1>freeTrialDuration2&&([freeTrialDuration1,freeTrialDuration2]=[freeTrialDuration2,freeTrialDuration1],[freeTrialLimit1,freeTrialLimit2]=[freeTrialLimit2,freeTrialLimit1]))),showFreeTrialLimitMessage&&showMessgesRemainingDiv(plan_type,last_plan_type,expiry_date)})}function sendMessageToBackground(message){chrome.tabs.query({active:!0,currentWindow:!0},function(tabs){chrome.tabs.sendMessage(tabs[0].id,message)})}function show_error(error){document.getElementById("error_message").style.display="block",document.getElementById("error_message").innerText=error}function reset_error(){document.getElementById("error_message").innerText="",document.getElementById("error_message").style.display="none"}async function sendMessageFunction(){let caption=await new Promise(resolve=>{chrome.storage.local.get(["captionForIndividualAttachment"],res=>{resolve(res.captionForIndividualAttachment||[])})});chrome.storage.local.set({captionForIndividualAttachment:[]}),document.querySelector(".captionTextAreas").innerHTML="";const messageSendingTo=messageToggleSwitchValue;var numbers_str=document.querySelector("textarea#numbers").value,message=document.querySelector("textarea#message").value,attachments_str=document.querySelector("#attachments-container").innerText;var time_gap,batch_size,batch_gap,random_delay=!1,custom_time_range=null;let send_attachment_first=!1;if($("#time_gap_checked").is(":checked")&&"random_custom"===$("#time_gap_type input[type='radio']:checked").val()&&!validateCustomRange())return;if($("#time_gap_checked").is(":checked")){if("sec"===$("#time_gap_type input[type='radio']:checked").val()&&(time_gap=parseInt(document.querySelector("#time_gap_sec").value)),"random"===$("#time_gap_type input[type='radio']:checked").val()&&(time_gap=4,random_delay=!0),"random_custom"===$("#time_gap_type input[type='radio']:checked").val()){const fromValue=parseInt(document.querySelector("#time_gap_from").value),toValue=parseInt(document.querySelector("#time_gap_to").value);if(isNaN(fromValue)||isNaN(toValue)||fromValue>=toValue)return void show_error("Invalid range. From value must be less than To value.");time_gap=Math.floor((fromValue+toValue)/2),random_delay=!0,custom_time_range={from:fromValue,to:toValue},trackButtonClick("campaign_started_with_custom_time_gap")}}else time_gap=isPremiumFeatureAvailable()?parseInt(3):parseInt(30);if($("#batch_checked").is(":checked")){if(!isPremiumFeatureAvailable())return sendMessageToBackground({type:"show_premium_popup",feature:"batching"}),void window.close();batch_size=document.querySelector("#batch_size").value,(batch_gap=document.querySelector("#batch_gap").value)&&(batch_gap=parseInt(batch_gap)),batch_size&&(batch_size=parseInt(batch_size))}$("#attachment-first-checkbox").is(":checked")&&(send_attachment_first=!0);var numbers=getFilteredNumbers(numbers_str).split(",").map(num=>country_info.dial_code+num);if(!numbers_str&&"numbers"==messageSendingTo)return void show_error("Please enter numbers to send");if(0==groups_selected.length&&"groups"==messageSendingTo)return void show_error("Please select groups to send");if(0==contacts_selected.length&&"contacts"==messageSendingTo)return void show_error("Please select contacts to send");if(0==labels_selected.length&&"labels"==messageSendingTo)return void show_error("Please select labels to send");if(0==message.trim().length&&0==attachments_str.length)return void show_error("Please enter message or attachment");let recipients,recipients_type,campaign_type;if(chrome.storage.local.get(["dsi854"],res=>{let dsi854=res.dsi854;caption.length>0&&dsi854<10&&chrome.storage.local.set({icu861:!0})}),"numbers"===messageSendingTo)recipients=numbers,recipients_type="numbers",campaign_type="number_message";else if("groups"===messageSendingTo)recipients=groups_selected,recipients_type="groups",campaign_type="group_message";else if("contacts"===messageSendingTo)recipients=contacts_selected.map(number=>number.replace("@c.us","")),recipients_type="numbers",campaign_type="number_message";else if("labels"===messageSendingTo){let labelsContacts=[];labels_selected.forEach(labelId=>{const label=allLabels.find(l=>l.id===labelId);label&&label.contacts&&label.contacts.length>0&&labelsContacts.push(...label.contacts)}),recipients=labelsContacts,recipients_type="numbers",campaign_type="number_message"}if(!await checkIfCanSendCampaign(recipients.length))return sendMessageToBackground({type:"show_message_count_over_popup"}),void window.close();sendMessageToBackground({type:campaign_type,[recipients_type]:recipients,message,time_gap,csv_data,customization:!0,caption_customization:!0,random_delay,batch_size,batch_gap,caption,send_attachment_first,custom_time_range}),window.close()}async function messagePreparation(){if(reset_error(),(await new Promise(resolve=>{chrome.storage.local.get(["attachmentsData"],res=>{resolve(res.attachmentsData||[])})})).length>3){const confirmOverlay=document.querySelector(".confirm-ovelay");confirmOverlay.style.display="flex";const cancelButton=document.querySelector(".cancelAction"),okButton=document.querySelector(".doAction");cancelButton.addEventListener("click",()=>{confirmOverlay.style.display="none"}),okButton.addEventListener("click",()=>{confirmOverlay.style.display="none",sendMessageFunction()})}else sendMessageFunction()}function processExcel(data){var workbook=XLSX.read(data,{type:"binary"});workbook.SheetNames[0];return data=to_json(workbook)}function to_json(workbook){var result={};return workbook.SheetNames.forEach(function(sheetName){var roa=XLSX.utils.sheet_to_json(workbook.Sheets[sheetName],{header:1});roa.length&&(result[sheetName]=roa)}),JSON.stringify(result,2,2)}function checkIfValidPhoneNumber(phoneNumber){return!/[a-zA-Z]/.test(phoneNumber)}function showInvalidExcelPopup(){trackSystemEvent("invalid_excel","invalid_excel");document.querySelector(".invalid-excel-popup-description").innerHTML="First column should only contain phone numbers.</br>Check template excel below.";const uploadAnywayBtn=document.getElementById("upload-anyway-button");uploadAnywayBtn&&(uploadAnywayBtn.style.display="none"),document.getElementById("invalid-excel-popup").classList.remove("hide")}function process_sheet_data_and_validate(data,checkForValid){if(data&&data.length>0){csv_data=[data[0]];for(var numbers="",column_headers=data[0],i=1;i<data.length;i++)if(data[i][0]){if(isValidPhoneNumber=checkIfValidPhoneNumber(data[i][0]),!isValidPhoneNumber)return customization_obj&&driver(translatedCustomObj).destroy(),customization_obj=!1,showInvalidExcelPopup(),void unset_csv_styles();csv_data.push(data[i]),numbers+=data[i][0],i!==data.length-1&&(numbers+=",")}document.getElementById("numbers").value=numbers,populateCustomizeData(),chrome.storage.local.set({csv_data}),chrome.storage.local.set({popup_numbers:numbers}),$("#numbers").click(),replaceNumbers(numbers);let isFirstRowValid=!0;if(checkForValid)for(const element of column_headers)!isNaN(Number(element))&&element.toString().length>=10&&(isFirstRowValid=!1);if(!isFirstRowValid){let invalidExcelPopup=document.getElementById("invalid-excel-popup");invalidExcelPopup.classList.remove("hide");document.getElementById("upload-anyway-button").addEventListener("click",()=>{invalidExcelPopup.classList.add("hide")})}}}function process_sheet_data(evt,checkForValid=!0){var f=evt.target.files[0];if(f){var r=new FileReader;r.onload=e=>{var data=processExcel(e.target.result);process_sheet_data_and_validate(data=(data=JSON.parse(data))[Object.keys(data)[0]],checkForValid)},r.readAsBinaryString(f)}}function set_csv_styles(file_name){file_name&&(csv_name=file_name.substring(0,15),file_name.length>15&&(file_name=csv_name+"..."),$("#campaign-name").val(csv_name),$("#campaign-selector").css("display","none"),$("#uploaded-csv").prop("hidden",!1).text(file_name),$("#customization").prop("checked",!0).trigger("change"),is_excel_uploaded=!0,chrome.storage.local.set({file_name:csv_name}))}function unset_csv_styles(){$("#csv").val(""),$("#campaign-name").val(""),$("#campaign-selector").css("display","flex"),$("#uploaded-csv").prop("hidden",!0).text(""),$("#customization").prop("checked",!1).trigger("change"),is_excel_uploaded=!1,chrome.storage.local.set({csv_data:[],file_name:""}),csv_data=[]}function getMessage(){$("#sender").click(function(){if(isPremiumExpired())return sendMessageToBackground({type:"show_premium_popup",feature:"send_message"}),void window.close();trackButtonClick("send_message_button_eligible"),messagePreparation(),trackButtonClick("send_message_button")}),$("#help").click(function(){sendMessageToBackground({type:"help"}),trackButtonClick("chat_support"),window.close()}),$("#how_to_use").click(function(){trackButtonClick("how_to_use_pro_sender"),"numbers"!==messageToggleSwitchValue&&document.querySelector("#message_type_numbers").click(),driver(translatedSendObj).drive(),removeHighlightTour()}),$("#request_chat_premium").click(function(){sendMessageToBackground({type:"request_chat_premium"}),trackButtonClick("request_chat_premium")}),$("#request_zoom_premium").click(function(){isAdvanceFeatureAvailable()?(sendMessageToBackground({type:"request_zoom_premium"}),trackButtonClick("request_zoom_premium")):sendMessageToBackground({type:"show_advance_popup",feature:"zoom_call_support"}),window.close()}),$("#request_call_premium").click(function(){sendMessageToBackground({type:"request_call_premium"}),trackButtonClick("request_call_premium")}),$("#chat_link").click(function(){sendMessageToBackground({type:"chat_link"}),window.close()});const convert_date=(date=null)=>date?new Date(date):null;$("#select_premium_features").click(async function(){document.querySelector(".premium_features_parent_div").classList.add("black_background"),document.getElementById("popup_functionality").style.display="none",document.getElementById("show_premium_features").style.display="block",document.getElementById("select_functionality_container").classList.remove("active"),document.getElementById("select_premium_container").classList.add("active"),document.getElementById("add_business_text").style.color="#fff",document.getElementById("add_business_img").src="logo/pro-plus-1.png",document.getElementById("ps-logo-right").src="logo/pro-logo-text.png",(isBasic()||isAdvance())&&(document.querySelector("#transfer_premium_button").style.display="flex");const showCountrySelector=document.querySelector("#show_country_selector");if(showCountrySelector){!function addCountryCodeSelectorToPremiumBlock(){const countrySelector=document.querySelector("#country-code-input-2"),initialCountry=country_info.name_code,intlTelInputConfig={separateDialCode:!0,autoHideDialCode:!1,autoPlaceholder:"off",initialCountry,preferredCountries:"XX"===initialCountry?[initialCountry]:["XX",initialCountry],autoPlaceholder:"aggressive",utilsScript:"library/intlTelInput.utils.js"};window.intlTelInput(countrySelector,intlTelInputConfig)}();const requestTransferBtn=document.querySelector("#request_transfer_btn");requestTransferBtn&&requestTransferBtn.addEventListener("click",function(){const inputNumber=document.querySelector("#premium_number_input").value;if(!inputNumber)return;let dialCode=function getCountryInfo(){const countrySelector=document.querySelector("#country-code-input-2"),intlTelInputInstance=window.intlTelInputGlobals.getInstance(countrySelector);let{name,iso2,dialCode}=intlTelInputInstance.getSelectedCountryData();return dialCode}();if("00"==dialCode)return;"52"==dialCode&&(dialCode+="1");const new_number=`${dialCode}${inputNumber}`;new_number===my_number?document.querySelector("#transfer_premium_error").style.display="block":(document.querySelector("#transfer_premium_error").style.display="none",sendMessageToBackground({type:"transfer_premium",message:`Hi, I would like to transfer the premium from +${my_number} to +${new_number}`}),window.close())}),showCountrySelector.addEventListener("click",()=>{const premiumCountrySelectorContainer=document.querySelector("#premium_country_selector_container");chrome.storage.local.get(["subscribed_date","customer_email"],function(result){if(result.subscribed_date){let today=new Date;(date1=today,date2=result.subscribed_date,date1=convert_date(date1),date2=convert_date(date2),date1&&date2?Math.floor((date1.getTime()-date2.getTime())/864e5):NaN)<=7&&result.customer_email?chrome.tabs.create({url:""}):premiumCountrySelectorContainer&&(premiumCountrySelectorContainer.classList.toggle("hide"),document.querySelector("#my_current_number").innerText="+"+my_number)}var date1,date2})})}if("Expired"==plan_type){let detailsText=getNonPremiumHeaderText()||"";detailsText=detailsText.split("-")[0],document.getElementById("plan_details").innerHTML=`<span style="font-weight: 700;">${detailsText}</span> on : <span style="font-weight: 700;">+${my_number}</span>`}else document.getElementById("plan_details").innerHTML=`<span style="font-weight: 700;">${plan_type} plan</span> enabled on : <span style="font-weight: 700;">+${my_number}</span>`;document.getElementById("customer_email").innerHTML=customer_email?`Registered email : <span style="font-weight: 700;">${customer_email} </span>`:"",isPremium()&&(document.getElementById("add_business_img").src="logo/pro-user-2.png"),changeInputPercentage(),showFaqsSection(),await showBuyPremiumButtons(),chrome.storage.local.get(["plan_duration"],function(result){result.plan_duration&&("Monthly"!=result.plan_duration&&"Expired"!=plan_type||(document.querySelector(".invoice_feature_block").style.display="flex",getInvoiceData()))})}),$("#select_functionality").click(function(){document.querySelector(".premium_features_parent_div").classList.remove("black_background"),document.getElementById("popup_functionality").style.display="block",document.getElementById("show_premium_features").style.display="none",document.getElementById("select_functionality_container").classList.add("active"),document.getElementById("select_premium_container").classList.remove("active"),document.getElementById("add_business_text").style.color="#009A88",document.getElementById("add_business_img").src="logo/pro-plus.png",document.getElementById("ps-logo-right").src="logo/pro-logo-text-light.png",isPremium()&&(document.querySelector(".premium_feature_block").style.display="flex",document.getElementById("add_business_img").src="logo/pro-user-1.png")}),$("#back_to_functionality").click(function(){document.getElementById("popup_functionality").style.display="block",document.getElementById("show_premium_features").style.display="none",document.getElementById("select_functionality").style.background="#62D9C7"}),$("#csv").on("click",function(event){isLinux&&(sendMessageToBackground({type:"create_csv_input"}),event.preventDefault(),window.close())}),$("#csv").on("change",async function(e){var file=document.getElementById("csv").files[0];if(file&&(set_csv_styles(file.name),showCustomizeContainer(),showCaptionCustomizationContainer(!0)),"text/csv"==file.type||file.name.endsWith(".csv")){process_sheet_data_and_validate(await convertCSVtoExcel(file),!0)}else process_sheet_data(e);trackButtonClick("csv_uploaded")}),$("#time_gap_checked").on("change",function(){var checked=$("#time_gap_checked").is(":checked"),style=checked?"flex":"none";document.getElementById("time_gap_type").style.display=style,chrome.storage.local.set({time_gap_checked:checked}),checked&&chrome.storage.local.get(["premiumUsageObject"],function(result){if(void 0!==result.premiumUsageObject){let updatedPremiumUsageObject={...result.premiumUsageObject,timeGap:!0};chrome.storage.local.set({premiumUsageObject:updatedPremiumUsageObject})}})}),$("#batch_checked").on("change",function(){var checked=$("#batch_checked").is(":checked"),style=checked?"grid":"none";document.getElementById("batch_info").style.display=style,isPremiumFeatureAvailable()&&chrome.storage.local.set({batch_checked:checked}),$("#batch_checked").is(":checked")&&chrome.storage.local.get(["premiumUsageObject"],function(result){if(void 0!==result.premiumUsageObject){let updatedPremiumUsageObject={...result.premiumUsageObject,batching:!0};chrome.storage.local.set({premiumUsageObject:updatedPremiumUsageObject})}})}),$("#slider_time_gap_sec").on("change",function(){var sliderBtn=document.querySelector("#slider_time_gap_sec"),numberBtn=document.querySelector("#time_gap_sec");numberBtn.value=[1,2,3,4,5,6,7,8,9,10,15,20][sliderBtn.value],time_gap=numberBtn.value,isPremiumFeatureAvailable()?chrome.storage.local.set({time_gap}):(sendMessageToBackground({type:"show_premium_popup",feature:"time_gap"}),window.close())}),$("#time_gap_sec").on("change",function(){if(isPremiumFeatureAvailable()){var time_gap=document.querySelector("#time_gap_sec").value,values=[1,2,3,4,5,6,7,8,9,10,15,20];if(values.includes(parseInt(time_gap))){const index=values.indexOf(parseInt(time_gap));document.querySelector("#slider_time_gap_sec").value=index}else time_gap>20?document.querySelector("#slider_time_gap_sec").value=values.length-1:0==time_gap&&(document.querySelector("#slider_time_gap_sec").value=3,document.querySelector("#time_gap_sec").value=3,time_gap=3);chrome.storage.local.set({time_gap})}else sendMessageToBackground({type:"show_premium_popup",feature:"time_gap"}),window.close()}),$("#random").on("change",function(){disableNumberTimeGapInput("sec"),isPremiumFeatureAvailable()||(sendMessageToBackground({type:"show_premium_popup",feature:"time_gap"}),window.close()),chrome.storage.local.set({time_gap_type:"random"}),trackButtonClick("random_delay_changed")}),$("#sec").on("change",function(){disableNumberTimeGapInput("random"),chrome.storage.local.set({time_gap_type:"sec"})}),$("#random_custom").on("change",function(){if(disableNumberTimeGapInput("random_custom"),!isAdvanceFeatureAvailable())return sendMessageToBackground({type:"show_advance_popup",feature:"custom_random_time_gap"}),void window.close();validateCustomRange(),chrome.storage.local.set({time_gap_type:"random_custom"}),trackButtonClick("random_custom_delay_changed"),chrome.storage.local.get(["premiumUsageObject"],function(result){if(void 0!==result.premiumUsageObject){let updatedPremiumUsageObject={...result.premiumUsageObject,customTimeGap:!0};chrome.storage.local.set({premiumUsageObject:updatedPremiumUsageObject})}})}),$("#time_gap_from").on("input",function(){const fromValue=parseInt(this.value);isNaN(fromValue)||chrome.storage.local.set({time_gap_from:fromValue}),validateCustomRange()}),$("#time_gap_to").on("input",function(){const toValue=parseInt(this.value);isNaN(toValue)||chrome.storage.local.set({time_gap_to:toValue}),validateCustomRange()}),$("#slider_batch_size").on("change",function(){const batchSize=document.querySelector("#batch_size"),sliderBatchSize=document.querySelector("#slider_batch_size");batchSize.value=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50][sliderBatchSize.value];var batch_size=parseInt(document.querySelector("#batch_size").value);chrome.storage.local.set({batch_size}),trackButtonClick("batch_size_changed")}),$("#batch_size").on("change",function(){var batch_size=document.querySelector("#batch_size").value,values=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50];if(values.includes(parseInt(batch_size))){const index=values.indexOf(parseInt(batch_size));document.querySelector("#slider_batch_size").value=index}else batch_size>50?document.querySelector("#slider_batch_size").value=values.length-1:0==batch_size&&(document.querySelector("#slider_batch_size").value=values.length-1,document.querySelector("#slider_batch_size").value=50,batch_size=50);chrome.storage.local.set({batch_size}),trackButtonClick("batch_size_changed")}),$("#slider_batch_gap").on("change",function(){const batchGap=document.querySelector("#batch_gap"),sliderBatchGap=document.querySelector("#slider_batch_gap");batchGap.value=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50][sliderBatchGap.value];var batch_gap=document.querySelector("#batch_gap").value;chrome.storage.local.set({batch_gap}),trackButtonClick("batch_gap_changed")}),$("#batch_gap").on("change",function(){var batch_gap=document.querySelector("#batch_gap").value,values=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50];if(values.includes(parseInt(batch_gap))){const index=values.indexOf(parseInt(batch_gap));document.querySelector("#slider_batch_gap").value=index}else batch_gap>50?document.querySelector("#slider_batch_gap").value=values.length-1:0==batch_gap&&(document.querySelector("#slider_batch_gap").value=13,batch_gap=30);chrome.storage.local.set({batch_gap}),trackButtonClick("batch_gap_changed")}),$("#time_gap_type input[type=radio]").on("change",function(e){var value=e.target.value;chrome.storage.local.set({time_gap_type:value})}),$("#chat_link_info").click(function(){document.getElementById("chat_link_info_popup").style.display="block"}),$(".help_popup_okay").click(function(){document.getElementById("help_popup").style.display="none",chrome.storage.local.get(["fva853","facc859"],res=>{1==res.facc859&&(isLinux?(sendMessageToBackground({type:"add_attachments"}),window.close()):$("#select-attachments").click(),chrome.storage.local.set({facc859:-1})),1==res.fva853&&chrome.storage.local.set({fva853:!1})})}),$("#chat_link_info_popup_okay").click(function(){document.getElementById("chat_link_info_popup").style.display="none"}),$("#numbers").on("change",function(e){var numbers=document.querySelector("textarea#numbers").value;chrome.storage.local.set({popup_numbers:numbers}),trackButtonClick("number_changed")}),$("#message").on("change",function(e){var message=document.querySelector("textarea#message").value;chrome.storage.local.set({popup_message:message}),trackButtonClick("message_changed")}),$("#time_gap").on("change",function(e){document.querySelector("#time_gap").value;trackButtonClick("time_gap_changed")}),$("#customization").on("change",function(e){var customization=document.querySelector("#customization").checked;chrome.storage.local.set({customization}),trackButtonClick("customization_added"),customization&&chrome.storage.local.get(["premiumUsageObject"],function(result){if(void 0!==result.premiumUsageObject){let updatedPremiumUsageObject={...result.premiumUsageObject,customisation:!0};chrome.storage.local.set({premiumUsageObject:updatedPremiumUsageObject})}})}),$("#customized_arr").on("change",function(e){var val=document.querySelector("#customized_arr").value,message=document.querySelector("textarea#message").value;message+=" {{"+val+"}}",document.querySelector("textarea#message").value=message,chrome.storage.local.set({popup_message:message})}),$("#schedule_checkbox").on("change",function(e){e.target.checked?(document.getElementById("schedule_message_div").hidden=!1,document.getElementById("schedule").hidden=!1,document.getElementById("sender").hidden=!0,document.querySelector("#schedule_day_div").style.display="flex",document.querySelector("#schedule_time_div").style.display="flex"):(document.getElementById("schedule_message_div").hidden=!0,document.getElementById("schedule").hidden=!0,document.getElementById("sender").hidden=!1,document.querySelector("#schedule_day_div").style.display="none",document.querySelector("#schedule_time_div").style.display="none")}),$("#schedule_time").on("change",function(e){var schedule_time=document.querySelector("#schedule_time").value;chrome.storage.local.set({schedule_time})}),$("#chatbot_enabled").on("change",function(){const isEnabled=$(this).is(":checked");if(isEnabled&&!isAdvanceFeatureAvailable())return $(this).prop("checked",!1),sendMessageToBackground({type:"show_advance_popup",feature:"chat_bot"}),void window.close();$("#chatbot_settings_btn").css("display",isEnabled?"block":"none");const chatbotSettings={enabled:isEnabled,rules:chatbotRules,repliesSent:chatbotRepliesSent};chrome.storage.local.set({chatbotSettings})}),$("#chatbot_settings_btn").on("click",function(e){e.preventDefault(),e.stopPropagation(),"function"==typeof openChatbotModal?openChatbotModal():console.error("‚ùå openChatbotModal function not found!")}),$("#chatbot_modal_close").on("click",function(e){e.preventDefault(),e.stopPropagation(),"function"==typeof closeChatbotModal&&closeChatbotModal()}),$("#chatbot_modal_close_btn").on("click",function(e){e.preventDefault(),e.stopPropagation(),"function"==typeof closeChatbotModal&&closeChatbotModal()}),$("#chatbot_add_rule_btn").on("click",function(e){e.preventDefault(),e.stopPropagation(),"function"==typeof addChatbotRule&&addChatbotRule()}),$("#chatbot_modal_popup").on("click",function(e){"chatbot_modal_popup"===e.target.id&&"function"==typeof closeChatbotModal&&closeChatbotModal()}),$("#addUniqueIdentifier").on("change",function(){const isEnabled=$(this).is(":checked");if(isEnabled&&!isPremiumFeatureAvailable())return $(this).prop("checked",!1),sendMessageToBackground({type:"show_premium_popup",feature:"anti_spam"}),void window.close();chrome.storage.local.set({addUniqueIdentifier:isEnabled})}),$("#survey_click").click(function(){document.getElementById("survey").style.display="none",chrome.storage.local.set({survey_click:!0}),trackButtonClick("survey_click"),window.open("","_blank")}),$("#my_number_submit").click(function(){var code=document.querySelector("#my_number_code").value,number=document.querySelector("#my_number").value;code&&number&&(my_number=(""+code+number).replace("+",""),trackButtonClick("my_number_submit"),document.getElementById("add_number_popup").style.display="none",document.getElementById("confirm_number_popup").style.display="block",document.getElementById("confirm_my_number").innerText="+"+my_number)}),$("#confirm_number_submit").click(function(){document.getElementById("confirm_number_popup").style.display="none",chrome.storage.local.set({my_number}),trackButtonClick("confirm_number_submit"),sendMessageToBackground({type:"reload_my_number"}),window.close()}),$("#edit_number_submit").click(function(){document.getElementById("confirm_number_popup").style.display="none",document.getElementById("add_number_popup").style.display="block",trackButtonClick("edit_number_submit")}),$("#unsubscribe").click(function(){sendMessageToBackground({type:"unsubscribe"}),trackButtonClick("unsubscribe")}),$("#buy_premium_popup").click(function(){trackButtonClick("buy_premium_popup"),window.open("","_blank")}),$("#learn_schedule").click(function(){sendMessageToBackground({type:"learn_schedule"}),trackButtonClick("learn_schedule")}),$("#schedule").click(function(){if(trackButtonClick("schedule_button"),isAdvanceFeatureAvailable()){if(trackButtonClick("schedule_button_premium"),reset_error(),$("#time_gap_checked").is(":checked")&&"random_custom"===$("#time_gap_type input[type='radio']:checked").val()&&!validateCustomRange())return;const messageSendingTo=messageToggleSwitchValue;var time_gap,batch_size,batch_gap,schedule_time=document.querySelector("#schedule_time").value,schedule_date=document.querySelector("#schedule_day").value,numbers_str=document.querySelector("textarea#numbers").value,message=document.querySelector("textarea#message").value,attachments_str=document.querySelector("#attachments-container").innerText,random_delay=!1,send_attachment_first=!1,custom_time_range=null;if($("#time_gap_checked").is(":checked")){if("sec"===$("#time_gap_type input[type='radio']:checked").val()&&(time_gap=parseInt(document.querySelector("#time_gap_sec").value)),"random"===$("#time_gap_type input[type='radio']:checked").val()&&(time_gap=4,random_delay=!0),"random_custom"===$("#time_gap_type input[type='radio']:checked").val()){if(!isAdvanceFeatureAvailable())return sendMessageToBackground({type:"show_premium_popup",feature:"custom_random_time_gap"}),void window.close();let from_value=parseInt(document.querySelector("#time_gap_from").value),to_value=parseInt(document.querySelector("#time_gap_to").value);const minAllowed=isAdvanceFeatureAvailable()?1:30,maxAllowed=300;if(from_value<minAllowed||to_value<minAllowed||from_value>maxAllowed||to_value>maxAllowed||from_value>=to_value)return void show_error(`Invalid range. Allowed: ${minAllowed}-${maxAllowed} seconds for your plan.`);time_gap=Math.floor((from_value+to_value)/2),random_delay=!0,custom_time_range={from:from_value,to:to_value},isPremiumFeatureAvailable()?trackButtonClick("scheduled_campaign_with_custom_time_gap_premium"):trackButtonClick("scheduled_campaign_with_custom_time_gap_free")}}else time_gap=isPremiumFeatureAvailable()?parseInt(3):parseInt(30);document.querySelector("#batch_checked").checked&&(batch_size=document.querySelector("#batch_size").value,batch_gap=document.querySelector("#batch_gap").value,batch_size&&(batch_size=parseInt(batch_size)),batch_gap&&(batch_gap=parseInt(batch_gap))),$("#attachment-first-checkbox").is(":checked")&&(send_attachment_first=!0);var numbers=getFilteredNumbers(numbers_str).split(",").map(num=>country_info.dial_code+num);if(!numbers_str&&"numbers"==messageSendingTo)return void show_error("Please enter numbers to send");if(0==groups_selected.length&&"groups"==messageSendingTo)return void show_error("Please select groups to send");if(0==contacts_selected.length&&"contacts"==messageSendingTo)return void show_error("Please select contacts to send");if(0==message.trim().length&&0==attachments_str.length)return void show_error("Please enter message or attachment");if(!schedule_time)return void show_error("Schedule time can't be blank");chrome.storage.local.get(["scheduled_campaigns"],async function(res){let scheduledCampaigns=res.scheduled_campaigns||[],prev_time=null,prev_date=null;if(scheduledCampaigns&&scheduledCampaigns.length>0&&(prev_time=scheduledCampaigns[scheduledCampaigns.length-1].campaign_duration,prev_date=scheduledCampaigns[scheduledCampaigns.length-1].end_date),null!=prev_time&&null!=prev_date&&convertToTimestamp(prev_date,prev_time)>=convertToTimestamp(schedule_date,schedule_time)){let scheduleCampaignError=document.querySelector("#schedule_campaign_error");const scheduleCampaignErrorTime=document.querySelector("#schedule_campaign_error_time");scheduleCampaignError.hidden=!1;let time=convertTo12Hour(prev_time);return scheduleCampaignErrorTime.innerHTML=formatScheduleDate(prev_date)+" "+time+" ",void setTimeout(()=>{scheduleCampaignError.hidden=!0},1e4)}if(scheduledCampaigns&&scheduledCampaigns.length>=10){const scheduleCampaignError2=document.querySelector("#schedule_campaign_error2");return scheduleCampaignError2.hidden=!1,void setTimeout(()=>{scheduleCampaignError2.hidden=!0},1e4)}chrome.storage.local.get(["attachmentsData"],async function(res){const attachmentsData=res.attachmentsData;let recipients,recipients_type,campaign_type,campaign_name="Campaign-"+(scheduledCampaigns.length+1),{time:campaign_duration,date:end_date}=addSecondsToScheduleTime(schedule_date,schedule_time,calculateCampaignDuration(time_gap,random_delay,batch_size,batch_gap,numbers,custom_time_range)),caption_customization=$("#caption_customization").is(":checked"),caption=await new Promise(resolve=>{chrome.storage.local.get(["captionForIndividualAttachment"],res=>{resolve(res.captionForIndividualAttachment||[])})});if("numbers"===messageSendingTo)recipients=numbers,recipients_type="numbers",campaign_type="number_message";else if("groups"===messageSendingTo)recipients=groups_selected,recipients_type="groups",campaign_type="group_message";else if("contacts"===messageSendingTo)recipients=contacts_selected.map(number=>number.replace("@c.us","")),recipients_type="numbers",campaign_type="number_message";else if("labels"===messageSendingTo){let labelsContacts=[];labels_selected.forEach(labelId=>{const label=allLabels.find(l=>l.id===labelId);label&&label.contacts&&label.contacts.length>0&&labelsContacts.push(...label.contacts)}),recipients=labelsContacts,recipients_type="numbers",campaign_type="number_message"}if(!await checkIfCanSendCampaign(recipients.length))return sendMessageToBackground({type:"show_message_count_over_popup"}),void window.close();scheduledCampaigns.push({type:campaign_type,[recipients_type]:recipients,message,time_gap,csv_data,customization:true,caption_customization,random_delay,batch_size,batch_gap,caption,send_attachment_first,campaign_name,schedule_time,schedule_date,campaign_duration,end_date,attachmentsData,custom_time_range}),scheduledCampaigns.sort((a,b)=>convertToTimestamp(a.schedule_date,a.schedule_time)-convertToTimestamp(b.schedule_date,b.schedule_time)),chrome.storage.local.set({scheduled_campaigns:scheduledCampaigns}),sendMessageToBackground({type:"schedule_message"}),window.close()})})}else sendMessageToBackground({type:"show_advance_popup",feature:"schedule"}),window.close();chrome.storage.local.get(["premiumUsageObject"],function(result){if(void 0!==result.premiumUsageObject){let updatedPremiumUsageObject={...result.premiumUsageObject,schedule:!0};chrome.storage.local.set({premiumUsageObject:updatedPremiumUsageObject})}})})}function addSecondsToScheduleTime(date,time,seconds){let[hours,minutes]=time.split(":"),dateObj=new Date(date);dateObj.setHours(hours),dateObj.setMinutes(minutes),dateObj.setSeconds(dateObj.getSeconds()+seconds),hours=dateObj.getHours(),minutes=dateObj.getMinutes(),seconds=dateObj.getSeconds(),hours=hours<10?"0"+hours:hours,minutes=minutes<10?"0"+minutes:minutes;let year=dateObj.getFullYear(),month=dateObj.getMonth()+1,day=dateObj.getDate();return month=month<10?"0"+month:month,day=day<10?"0"+day:day,{date:`${year}-${month}-${day}`,time:`${hours}:${minutes}`}}function convertToTimestamp(date,time){return new Date(date+"T"+time).getTime()}function timeToTimestamp(time){let[hours,minutes]=time.split(":");return(new Date).setHours(parseInt(hours),parseInt(minutes),0,0)}function convertTo12Hour(time){let[hours,minutes]=time.split(":"),date=new Date;date.setHours(hours),date.setMinutes(minutes);let period=hours>=12?"PM":"AM";return hours%=12,hours=hours||12,`${hours}:${minutes} ${period}`}const CUSTOM_RANGE_ERROR_MESSAGES={INVALID_RANGE:"From value must be less than To value",OUT_OF_BOUNDS:"Values must be between 1 and 300 seconds",PREMIUM_RESTRICTION:"Minimum time gap is 30 seconds for free users",ADVANCE_RESTRICTION:"Random Custom feature requires Advanced subscription. Upgrade to access custom time ranges from 1 second.",INVALID_NUMBER:"Please enter valid numbers only",EMPTY_VALUES:"Both From and To values are required",EXECUTION_FALLBACK:"Invalid custom range detected, using default random range (3-10 seconds)"};function showCustomRangeError(message){const errorDiv=document.getElementById("custom_range_error");errorDiv&&(errorDiv.textContent=message,errorDiv.style.display="block",errorDiv.setAttribute("aria-live","polite"))}function hideCustomRangeError(){const errorDiv=document.getElementById("custom_range_error");errorDiv&&(errorDiv.style.display="none",errorDiv.textContent="")}function getSafeCustomRange(){const fromInput=document.querySelector("#time_gap_from"),toInput=document.querySelector("#time_gap_to");if(!fromInput||!toInput)return null;const fromValue=parseInt(fromInput.value),toValue=parseInt(toInput.value);if(isNaN(fromValue)||isNaN(toValue)||fromValue>=toValue||fromValue<1||toValue>300)return console.warn("Invalid custom range detected during execution, falling back to default"),null;const minAllowed=isPremiumFeatureAvailable()?1:30;return{from:Math.max(fromValue,minAllowed),to:Math.max(toValue,minAllowed)}}function getTimeGap(index,batch_size,time_gap,random_delay,batch_gap,custom_range=null){return 0==index?1:batch_size&&index%batch_size==0?batch_gap:random_delay?custom_range&&custom_range.from&&custom_range.to?custom_range.from>=custom_range.to||custom_range.from<1||custom_range.to>300?(console.warn(CUSTOM_RANGE_ERROR_MESSAGES.EXECUTION_FALLBACK),getRandomNumber(3,10)):getRandomNumber(custom_range.from,custom_range.to):getRandomNumber(3,10):time_gap}function getRandomNumber(min,max){return Math.ceil(Math.random()*(max-min)+min)}function calculateCampaignDuration(time_gap,random_delay,batch_size,batch_gap,numbers,custom_range=null){let total_time=0;for(let i=0;i<numbers.length;i++){total_time+=getTimeGap(i,batch_size,time_gap,random_delay,batch_gap,custom_range)}return total_time+=900,total_time}function formatScheduleDate(date){const[year,month,day]=date.split("-");return`${day}/${month}/${year}`}function hasDateTimePassed(date,time){let dateTime=new Date(date+"T"+time);return dateTime.setMinutes(dateTime.getMinutes()+2),new Date>dateTime}async function scheduleExpiredPopup(){chrome.storage.local.get(["scheduled_campaigns"],function(res){let scheduledCampaigns=res.scheduled_campaigns||[];for(let i=0;i<scheduledCampaigns.length;i++){if(hasDateTimePassed(scheduledCampaigns[i].schedule_date,scheduledCampaigns[i].schedule_time))return void showScheduleExpiredPopup(scheduledCampaigns[i],i)}})}async function loadScheduledCampaigns(scheduledCampaigns){if($("#schedule_container").html(""),scheduledCampaigns&&scheduledCampaigns.length>0)for(let index=0;index<scheduledCampaigns.length;index++){let campaignName=scheduledCampaigns[index].campaign_name||"Campaign-"+Number(index+1),scheduleTime=scheduledCampaigns[index].schedule_time,campaignDate=formatScheduleDate(scheduledCampaigns[index].schedule_date);$("#schedule_container").append(`\n                <div class="dropdown-item">\n                    <p id="${index}" class="campaign_name text">\n                        <img src="./logo/pro-excel_icon.png"/>\n                        <span style="color: #009A88;">${campaignName}</span>\n                        <span style="color: #5D6063;">${campaignDate} ${scheduleTime}</span>\n                    </p>\n                    <img id="${index}" class="campaign_delete_btn btn CtaBtn" src="./logo/pro-delete-icon.png" />\n                </div>`)}else $("#schedule_container").append(`<div class="dropdown-item">${await translate("No scheduled campaigns")}</div>`);$(".campaign_delete_btn").click(function(){let index=$(this).attr("id");const timeoutId=scheduledCampaigns[index].timeOutId;timeoutId&&sendMessageToBackground({type:"clear_schedule_timeout",timeoutId});const newScheduledCampaigns=scheduledCampaigns.filter((campaign,i)=>i!=index);chrome.storage.local.set({scheduled_campaigns:newScheduledCampaigns}),loadScheduledCampaigns(newScheduledCampaigns)})}function getTrackLabel(){try{return[my_number,plan_type,plan_duration].join(" ").trim()}catch{return""}}function getTrackLocation(){return location_info.default?{}:{city:location_info.city,region:location_info.region,country:location_info.country,dial_code:location_info.dial_code}}function trackEvent(event,track){trackGenericEvent(event,{type:"event",track,natural_interaction:!0})}function trackButtonClick(event){trackGenericEvent(event,{type:"clicked",natural_interaction:!0})}function trackCloseButtonClick(event){trackGenericEvent(event,{type:"clicked"})}function trackButtonView(event){trackGenericEvent(event,{type:"viewed"})}function trackSystemEvent(event,track=""){trackGenericEvent(event,{type:"event",track})}function trackSuccess(event){trackGenericEvent(event,{type:"success"})}function trackError(event,error=""){trackGenericEvent(event,{type:"error",error:String(error)})}function trackGenericEvent(event,data){let label=getTrackLabel(),combinedData={...getTrackLocation(),...data},eventData=Object.fromEntries(Object.entries(combinedData).filter(([key,value])=>null!=value||null!=value));GoogleAnalytics.trackEvent(event,{label,...eventData})}function isExpired(){return"Expired"===plan_type}function isBasic(){return"Basic"===plan_type}function isAdvance(){return"Advance"===plan_type}function isPremium(){return"Basic"===plan_type||"Advance"===plan_type}function isFreeTrial(){return"FreeTrial"===plan_type}function isAdvancePromo(){return"AdvancePromo"===plan_type}function isTrial(){return"FreeTrial"===plan_type||"AdvancePromo"===plan_type}function isBasicFeatureAvailable(){return isBasic()||isTrial()}function isAdvanceFeatureAvailable(){return isAdvance()||isAdvancePromo()}function isPremiumFeatureAvailable(){return!0}function isPremiumExpired(){return isExpired()&&("Basic"==last_plan_type||"Advance"==last_plan_type)}function getFilteredNumbers(numbers_str){let numbers=numbers_str.replace(/\n/g,",").split(",");return numbers=numbers.map(num=>num.replace(/\D/g,"")),numbers=numbers.filter(num=>num.length>=5&&num.length<=15),numbers.join(",")}function getItemsName(){let itemsElements=document.querySelectorAll(".group");return Array.from(itemsElements).slice(0,-1).map(item=>item.innerHTML.trim()).join(", ")}function getCampaigns(callback){chrome.storage.local.get(["campaigns"],res=>{let campaigns=res.campaigns||[];callback(campaigns)})}function saveCampaign(campName,campData,callback){getCampaigns(campaigns=>{campaigns.some(campaign=>campaign.name===campName)?(alert(`Campaign name "${campName}" already exists!`),callback(!1)):(campaigns.push({name:campName,...campData}),chrome.storage.local.set({campaigns},()=>callback(!0)))})}function updateCampaign(index,campName,campData,callback){getCampaigns(campaigns=>{campaigns[index]?(campaigns[index]={name:campName,...campData},chrome.storage.local.set({campaigns},()=>callback(!0))):(alert("Invalid campaign index."),callback(!1))})}function getDaySuffix(day){if(day>=11&&day<=13)return"th";switch(day%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}function getReportDateFormat(date_ms,isDownloadName=!1){const today=new Date,reportDate=new Date(date_ms),diffDays=Math.round(Math.abs((today-reportDate)/864e5)),reportDay=reportDate.getDate(),dayString=reportDay+getDaySuffix(reportDay);let reportDateString,reportTimeString=reportDate.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric"});return isDownloadName||diffDays>1?reportDateString=`${dayString} ${reportDate.toLocaleDateString("en-US",{month:"short"})}`:0===diffDays?reportDateString="Today":1===diffDays&&(reportDateString="Yesterday"),isDownloadName?`(Last Run at ${reportDateString} ${reportTimeString})`:`(Last Run: ${reportDateString} ${reportTimeString})`}function download_csv(rows,filename){const csvContent="data:text/csv;charset=utf-8,"+rows.map(e=>e.join(",")).join("\n"),encodedUri=encodeURI(csvContent),link=$("<a>").attr({href:encodedUri,download:filename}).appendTo("body");link[0].click(),link.remove()}function getCustomNumberPlaceholder(){let defaulltPlaceholder="Enter numbers separated by comma or one below the other. Eg. ",sampleNumber=$("#country-code-input").attr("placeholder").replace(/\D/g,"");""===sampleNumber?sampleNumber="+91 8123456789, +1 2015550123":sampleNumber.startsWith("0")&&(sampleNumber=sampleNumber.substr(1));let customPlaceholder="";if("+91 8123456789, +1 2015550123"!=sampleNumber){let startingDigits=sampleNumber.slice(0,-6),lastSixDigits=sampleNumber.slice(-6);customPlaceholder=defaulltPlaceholder+sampleNumber+", "+(startingDigits+lastSixDigits.split("").reverse().join(""))}else customPlaceholder=defaulltPlaceholder+sampleNumber;return customPlaceholder}function addCountryCodeSelector(){const countrySelector=document.querySelector("#country-code-input"),initialCountry=country_info.name_code,intlTelInputConfig={separateDialCode:!0,autoHideDialCode:!1,autoPlaceholder:"off",initialCountry,preferredCountries:"XX"===initialCountry?[initialCountry]:["XX",initialCountry],autoPlaceholder:"aggressive",utilsScript:"library/intlTelInput.utils.js"};window.intlTelInput(countrySelector,intlTelInputConfig),updateCountryInfo(),countrySelector.addEventListener("countrychange",()=>{updateCountryInfo(),refreshNumbers()})}function updateCountryInfo(){const countrySelector=document.querySelector("#country-code-input"),intlTelInputInstance=window.intlTelInputGlobals.getInstance(countrySelector);let{name,iso2,dialCode}=intlTelInputInstance.getSelectedCountryData();"00"===dialCode&&(dialCode=""),country_info={name,name_code:iso2.toUpperCase(),dial_code:dialCode},chrome.storage.local.set({country_info}),$("#numbers-input").attr("placeholder",getCustomNumberPlaceholder())}function refreshNumbers(){const numberTags=$("#numbers-display .number-tag .number"),numbers=[];numberTags.each(function(){let nationalNumber=$(this).text().trim();numbers.push(nationalNumber)});replaceNumbers(numbers.join(", "))}function replaceNumbers(newNumbers){$("#numbers-display").empty(),$("#numbers-input").val(""),addNumberTags(newNumbers)}function isValidNumber(number){let{dial_code,name_code}=country_info,default_invalid_reason={isValid:!1,nationalNumber:number,reason:"INCORRECT COUNTRY CODE"};const checkNumber=num=>{try{let parsedNumber=libphonenumber.parsePhoneNumber("+"+num);return parsedNumber&&parsedNumber.isValid()?"XX"===name_code?{isValid:!0,nationalNumber:num,reason:""}:name_code===parsedNumber.country?{isValid:!0,nationalNumber:parsedNumber.nationalNumber,reason:""}:default_invalid_reason:default_invalid_reason}catch(error){return{isValid:!1,nationalNumber:num,reason:error.message}}};let response1=checkNumber(number),response2=checkNumber(dial_code+number);return response1.isValid?response1:response2.isValid?response2:default_invalid_reason}function toggleUploadExcelText(show){const isNumberTagPresent=document.querySelectorAll(".number-tag").length,uploadExcelText=document.querySelector(".upload_excel_text");uploadExcelText&&isNumberTagPresent&&!show?uploadExcelText.style.display="none":uploadExcelText&&!isNumberTagPresent&&show&&(uploadExcelText.style.display="flex")}function addNumberTags(numbers_str){const numbers=getFilteredNumbers(numbers_str).split(",");let numberTagsHtml="";for(let number of numbers)if(number){let{isValid,nationalNumber,reason}=isValidNumber(number);numberTagsHtml+=`\n                <span class="number-tag CtaBtn ${isValid?"":"invalid"}">\n                    ${isValid?"":'<span class="invalid-reason" hidden="true">'+reason+"</span>"}\n                    <span class="number" title="Edit Number">${nationalNumber}</span>\n                    <img class="delete-number-tag" src="./logo/pro-closeBtn.png" title="Remove Number">\n                </span>`}$("#numbers-display").append(numberTagsHtml),updateNumbersAndDisplay(),toggleUploadExcelText(!1)}function editNumberTag(tag){const currentNumber=$(tag).text(),numberTag=$(tag).parent(".number-tag"),numberTagWidth=$(tag).width()+7+"px",numberInput=$(`<input type="text" class="number-tag-input" maxlength="16" style="max-width:${numberTagWidth};">`);numberTag.html(numberInput),numberTag.addClass("active-input"),numberTag.removeClass("CtaBtn"),numberInput.val(currentNumber),numberInput.focus(),numberInput.on("blur keydown keyup",function(event){if(event.keyCode&&![13,188].includes(event.keyCode))return;let editedNumber=getFilteredNumbers($(this).val()).split(",")[0];if(editedNumber){is_excel_uploaded&&removeNumbers();let{isValid,nationalNumber,reason}=isValidNumber(editedNumber);for(let i=0;i<csv_data.length;i++)if(csv_data[i][0]&&csv_data[i][0].toString().includes(currentNumber)){csv_data[i][0]=parseInt(editedNumber);break}chrome.storage.local.set({csv_data}),numberTag.toggleClass("invalid",!isValid),numberTag.removeClass("active-input"),numberTag.addClass("CtaBtn"),numberTag.html(`\n                ${isValid?"":'<span class="invalid-reason" hidden="true">'+reason+"</span>"}\n                <span class="number" title="Edit Number">${nationalNumber}</span>\n                <img class="delete-number-tag" src="./logo/pro-closeBtn.png" title="Remove Number">\n            `)}else $(this).parent(".number-tag").remove();updateNumbersAndDisplay()})}function updateNumbersAndDisplay(){const numberTags=$("#numbers-display .number-tag .number"),numbers=[];numberTags.each(function(){let nationalNumber=$(this).text().trim();numbers.push(nationalNumber)}),$("#numbers").val(numbers.join(", ")),$("#numbers").trigger("change");let invalidCount=$(".number-tag.invalid").length;Number(invalidCount)>500&&(invalidCount="500+"),$("#invalid-numbers").css("display",invalidCount?"flex":"none"),$("#invalid-count").text(invalidCount),$("#delete-all-numbers").css("display",numbers.length?"block":"none"),$("#numbers-input").attr("placeholder",numbers.length?"":getCustomNumberPlaceholder()),$("#numbers-display").animate({scrollTop:$("#numbers-display")[0].scrollHeight},500)}function removeNumbers(){unset_csv_styles(),hideCustomizationContainer(),toggleUploadExcelText(!0)}function handleDeleteBin(){$("#delete-all").css("display","groups"===messageToggleSwitchValue?groups_selected.length>0?"block":"none":"contacts"===messageToggleSwitchValue?contacts_selected.length>0?"block":"none":"labels"===messageToggleSwitchValue&&labels_selected.length>0?"block":"none")}function showGroupsCampaignSelectorOrSave(){chrome.storage.local.get(["campaigns"],res=>{let isCampaignPresent=!1;const numbers=getItemsName();let filteredCampaigns=filterCampaignsByType(res.campaigns||[],messageToggleSwitchValue),selectedArray="groups"===messageToggleSwitchValue?groups_selected:contacts_selected;filteredCampaigns.forEach(campaign=>{numbers===campaign[messageToggleSwitchValue]&&(isCampaignPresent=!0)}),isCampaignPresent||0===selectedArray.length?($("#campaign_selector_groups").removeClass("hide"),$("#campaign-save-icon-items").addClass("hide")):($("#campaign_selector_groups").addClass("hide"),$("#campaign-save-icon-items").removeClass("hide"))})}function filterCampaignsByType(campaigns,type){return campaigns.filter(campaign=>campaign[type]&&campaign[type].length>0)}async function translate(text,sourceLanguage="en",targetLanguage=currentLanguage){return null==text||0===text.trim().length?"":new Promise(resolve=>{chrome.storage.local.get(["translatedCache"],async function(result){const cache=result.translatedCache||{};if(cache[text]&&cache[text][targetLanguage])resolve(cache[text][targetLanguage]);else{const translatedText=await translateAPI(text,sourceLanguage,targetLanguage);cache[text]||(cache[text]={}),cache[text][targetLanguage]=translatedText,chrome.storage.local.set({translatedCache:cache},function(){resolve(translatedText)})}})})}async function translateAPI(text,sourceLanguage="en",targetLanguage=currentLanguage){let filter=normalText=>normalText.replaceAll(/<<(.*?)>>/gi,'<span class="styled_text">$1</span>');if(null==text||0===text.trim().length)return"";if("default"===targetLanguage||targetLanguage===sourceLanguage)return filter(text);const translateAPI=`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLanguage}&tl=${targetLanguage}&dt=t&q=${encodeURI(text)}`;return await new Promise(resolve=>{try{$.getJSON(translateAPI,function(data){let translatedText=data[0].map(row=>row[0]).join(" ");resolve(filter(translatedText))})}catch(err){console.log("Translation Error:",err),resolve(filter(text))}})}function createOption(__text,__value,__selected=!1,__disabled=!1){let option=document.createElement("option");return option.text=__text,option.value=__value,option.selected=__selected,option.disabled=__disabled,option}function getFet(key){let fet;return"groupContactExport"==key&&(fet="Export Group Contacts"),"customisation"==key&&(fet="Customization"),"batching"==key&&(fet="Batching"),"timeGap"==key&&(fet="Time Gap"),"stop"==key&&(fet="Stop"),"quickReplies"==key&&(fet="Quick Replies"),"schedule"==key&&(fet="Schedule"),"multipleAttachment"==key&&(fet="Multiple Attachment"),"attachment"==key&&(fet="Attachment"),"caption"==key&&(fet="Caption"),fet}function changeInputPercentage(){chrome.storage.local.get(["premiumUsageObject"],async function(result){let message,total,premiumUsageObject=result.premiumUsageObject,used=0,feature1=null,feature2=null,feature3=null;for(const key in premiumUsageObject)if(1==premiumUsageObject[key])used++;else if("lastDate"!=key&&"lastMonth"!=key){let fet=getFet(key);null==feature1?feature1=fet:null==feature2?feature2=fet:null==feature3&&(feature3=fet)}isAdvance()?total=10:isBasic()?total=8:(used=0,total=10);let percentage=used/total*100;isPremium()||(percentage=0),document.getElementsByClassName("premium-utlisation-precentage")[0].innerText=`${percentage}%`;let showPercentage=100-percentage;document.getElementById("pie").style.backgroundImage=`conic-gradient(#000 ${showPercentage.toString()}%, #009188 0%)`;let{name:country_name,name_code:country_code,currency:country_currency}=location_info;country_name=Object.keys(COUNTRY_WITH_SPECIFIC_PRICING).includes(country_code)?COUNTRY_WITH_SPECIFIC_PRICING[country_code]:"international";let pricingButtonLink="";("Basic"==last_plan_type||"Advance"==last_plan_type)&&(pricingButtonLink=""),message=100==percentage?`<p>${await translate("Congrats! Your premium features utilisation is at 100%")}</p>`:isPremium()?`\n            <p>\n                <span style="color: #FFA500">Alert: </span>\n                <span>${await translate("You are not using all the features you have paid for! You have used "+percentage+"% of the paid features in the last week. Please use features like ")}</span>\n                <span style="color: #009A88; font-weight: 800;">${null!=feature1?`'${feature1}'`:""}</span> \n                <span style="color: #009A88; font-weight: 800;">${null!=feature2?`, '${feature2}'`:""}</span>\n                <span style="color: #009A88; font-weight: 800;">${null!=feature3?` and '${feature3}'`:""} </span> \n                <span>${await translate("to utilise premium to the fullest. Click on ")}</span>\n                <span class="CtaBtn" id="premium_help" style="text-decoration: underline; cursor: pointer;">${await translate("Live Support")}</span> \n                <span>${await translate(" to understand these features in detail")}</span>\n            </p>`:`\n            <p>\n                <span>${await translate("Your premium utilisation is at "+percentage+"%. Please purchase premium to utilise all the features.")}</span>\n                <span>${await translate("To checkout pricing")} </span>\n                <a class="CtaBtn" href="${pricingButtonLink}" target="_blank" style="color: #009A88; font-weight: 800;">${await translate("Click Here")}</a>  -\n                <span style="color: #2758D4">${await translate("Discount now available")}</span>\n            </p>`,document.getElementById("premium_utilisation_text").innerHTML=message,$("#premium_help").click(function(){sendMessageToBackground({type:"help"}),trackButtonClick("chat_support"),window.close()})})}async function getMultipleAccountsData(){chrome.storage.local.get(["multipleAccountsData"],async function(res){if(!res||!res?.isFetchedToday||subscribed_date==getTodayDate())try{await fetch("api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:parentEmail})})}catch(error){console.log("Error while fetching multiple accounts data",error)}})}function showMultipleAccountSection(){if(getMultipleAccountsData(),!isMultipleAccount)return;const multiple_account_bloc=document.querySelector(".mult_account_block");multiple_account_bloc.classList.remove("hide");let show_more_html="",show_less_html="",top_html='<div style="color:#fff;display:flex;justify-content:flex-start;align-items:center;gap:5px;flex-wrap:wrap;">\n            <p style="margin:0px !important;">Other numbers in the plan :</p>';show_more_html=top_html;for(let i=0;i<5;i++)show_more_html+=`<span class="mult_num_tag" style="background:#009a88 !important">${otherNumbers[i]}</span>`;show_more_html+='<span class="mult_show_more_section">... <span class="show_all_mult_numbers" style="cursor:pointer;text-decoration:underline;">show more</span></span></div>',show_more_html+="</div>",show_less_html=top_html;for(let i=5;i<otherNumbers.length;i++)show_less_html+=`<span class="mult_num_tag" style="background:#009a88 !important">${otherNumbers[i]}</span>`;show_less_html+='<span class="mult_show_more_section"><span class="show_all_mult_numbers" style="cursor:pointer;text-decoration:underline;">show less</span></span></div>',show_less_html+="</div>",multiple_account_bloc.innerHTML=show_more_html,document.querySelector(".mult_show_more_section").addEventListener("click",function(){showAllMultNumbers=!showAllMultNumbers,multiple_account_bloc.innerHTML=showAllMultNumbers?show_more_html:show_less_html,document.querySelector(".show_all_mult_numbers").addEventListener("click",function(){showAllMultNumbers=!showAllMultNumbers,showMultipleAccountSection()})})}function showFaqsSection(){const faqSection=document.querySelector(".premium_feature_faq");if(!faqSection)return;let faqHtml="";FAQS.forEach((faq,index)=>{faqHtml+=`\n            <div class="premium_feature_block">\n                <div class="faq_question_block">\n                    <p class="faq_question">${index+1}) ${faq.question}</p>\n                    <img src="logo/pro-dropdown_icon.png" />\n                </div>\n                <p class="faq_answer">${faq.answer}</p>\n            </div>\n            `}),faqSection.innerHTML=faqHtml;const allQuestions=document.querySelectorAll(".faq_question_block");allQuestions.length>0&&allQuestions.forEach((question,_)=>{question.addEventListener("click",function(){const answer=question.nextElementSibling;"block"==answer.style.display?(answer.style.display="none",question.children[1].style.transform="rotate(0deg)"):(answer.style.display="block",question.children[1].style.transform="rotate(180deg)")})})}function getFreeTrialButtonHtml(){return'<a href="" target="_blank" class="popup-btn pricing-green-btn CtaBtn" style="font-weight:bold;font-size:14px;">\n            Buy Premium\n        </a>'}async function getBasicPremiumExpiredButton(basicPrice,basicConvertedPrice,advancePrice,advanceConvertedPrice,pricing_link){return{basicButtonHtml:await basicButton(pricing_link+"basic",basicPrice,basicConvertedPrice),advanceButtonHtml:await advanceButton(pricing_link+"advance",advancePrice,advanceConvertedPrice,"premium_expired")}}async function getAdvancePremiumExpiredButton(advancePrice,advanceConvertedPrice,pricing_link){return await advanceButton(pricing_link+"advance",advancePrice,advanceConvertedPrice,"premium_expired",!1)}async function showBuyPremiumButtons(){let pricing_data;if(pricing_data="FreeTrial"==last_plan_type||"FreeTrial"==plan_type?PRICING_DATA.free_trial_expired:PRICING_DATA.premium_expired,!pricing_data)return"";let buy_premium_section=document.querySelector("#buy_premium_block"),premium_buttons_html=`\n            <div class="premium_features_divider">\n<p style="z-index: 1000; color: #fff; margin: 0px; margin-left: 16px;">Buy ${"Basic"==plan_type||"Advance"==plan_type?"Multiple Users":"Premium"} :</p>\n        </div>`,{name:country_name,name_code:country_code,currency:country_currency}=location_info;country_name=Object.keys(COUNTRY_WITH_SPECIFIC_PRICING).includes(country_code)?COUNTRY_WITH_SPECIFIC_PRICING[country_code]:"international";let advancePrice=pricing_data.advance_price[country_name],basicPrice=pricing_data.basic_price[country_name],advanceConvertedPrice=await convertPriceToLocale(advancePrice.substring(1)),basicConvertedPrice=await convertPriceToLocale(basicPrice.substring(1));if("FreeTrial"==plan_type||"Expired"==plan_type&&"FreeTrial"==last_plan_type)premium_buttons_html+=getFreeTrialButtonHtml();else if("Expired"==plan_type){if("Basic"==last_plan_type){let{basicButtonHtml,advanceButtonHtml}=await getBasicPremiumExpiredButton(basicPrice,basicConvertedPrice,advancePrice,advanceConvertedPrice,"");premium_buttons_html+=basicButtonHtml+advanceButtonHtml}else if("Advance"==last_plan_type){premium_buttons_html+=await getAdvancePremiumExpiredButton(advancePrice,advanceConvertedPrice,"")}premium_buttons_html+='<br /> <div style="width:100%;display:flex;justify-content:flex-start;align-items:center;margin-left:-16px;">\n                <a href="" target="_blank" style="color:#009a88;font-size:14px;text-decoration:underline;font-weight:bold;">Purchase for multiple users</a>\n            </div>'}else premium_buttons_html='<div style="width:100%;display:flex;justify-content:flex-start;align-items:center;margin-left:-16px;">\n                <a href="" target="_blank" style="color:#009a88;font-size:14px;text-decoration:underline;font-weight:bold;">Purchase for multiple users</a>\n            </div>';buy_premium_section.innerHTML=premium_buttons_html}async function getInvoiceData(){chrome.storage.local.get(["invoiceObject"],function(result){let data=[];const dates=result.invoiceObject;data=null==dates?[]:dates;const invoiceInputSection=document.getElementById("invoice_input");let optionsHtml="";data.length>0?(data.map(item=>optionsHtml+=`<option value="${item.date}">${item.date}</option>`),document.getElementById("download_invoice_button").href=data[0]?.invoice_pdf_url):optionsHtml='<option value="invoice_not_found">No Receipt Found</option>',""==optionsHtml&&(optionsHtml='<option value="invoice_not_found">No Receipt Found</option>'),invoiceInputSection.innerHTML=optionsHtml,invoiceInputSection.addEventListener("change",e=>{const selectedDate=e.target.value,invoice=data.find(item=>item.date==selectedDate);invoice&&(document.getElementById("download_invoice_button").href=invoice.invoice_pdf_url)});const invoiceButtonLoader=document.getElementById("invoice_button_loader"),invoiceButtonText=document.getElementById("invoice_button_text");document.getElementById("download_invoice_button").addEventListener("click",()=>{invoiceButtonLoader.style.display="flex",invoiceButtonText.style.display="none",setTimeout(()=>{const invoiceButtonLoader=document.getElementById("invoice_button_loader"),invoiceButtonText=document.getElementById("invoice_button_text");invoiceButtonLoader&&invoiceButtonText&&(invoiceButtonLoader.style.display="none",invoiceButtonText.style.display="flex")},5e3)})})}async function makeNewDesignResponse(res){try{const response=await fetch("",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify([{"Contact Number":my_number,"Yes/No":res,"Date/time":(new Date).toLocaleString("en-in")}])});await response.json()}catch(error){console.log("error from sheetdb api call",error)}}async function showNewDesignReviewButtons(){chrome.storage.local.get(["campaignNumber","newDesignLiked","newDesignSessions"],function(res){let campaignNumber=res.campaignNumber,newDesignLiked=res.newDesignLiked,newDesignSessions=res.newDesignSessions;null!=res.newDesignLiked&&null!=res.newDesignLiked||(chrome.storage.local.set({newDesignLiked:!1}),newDesignLiked=!1),null!=res.newDesignSessions&&null!=res.newDesignSessions||(chrome.storage.local.set({newDesignSessions:0}),newDesignSessions=0);if(campaignNumber&&!newDesignLiked&&newDesignSessions<10){const getReviewStripInterval=setInterval(()=>{const reviewStrip=document.querySelector(".new_popup_question_strip");if(reviewStrip){clearInterval(getReviewStripInterval),reviewStrip.style.display="flex",reviewStrip.hidden=!1;const yesButton=document.querySelector(".question_yes_button"),noButton=document.querySelector(".question_no_button");yesButton.addEventListener("click",async()=>{chrome.storage.local.set({newDesignLiked:!0}),document.body.removeChild(reviewStrip)}),noButton.addEventListener("click",async()=>{chrome.storage.local.set({newDesignLiked:!0}),document.body.removeChild(reviewStrip)}),chrome.storage.local.set({newDesignSessions:newDesignSessions+1})}},200)}})}function elementsToBeHighlighted(){const numbersBox=document.querySelector(".numbers-box"),messageBox=document.querySelector(".message-box"),numberBoxTitle=document.querySelector(".numbers-box .text_title"),messageBoxTitle=document.querySelector(".message-box .text_title"),actionsButtonContainer=document.querySelector(".action_buttons_div"),numbersBoxNavigationContainer=document.querySelectorAll(".numbers-box .navigation_container"),messageBoxNavigationContainer=document.querySelectorAll(".message-box .navigation_container"),buttonsBoxNavigationContainer=document.querySelectorAll(".action_buttons_div .navigation_container"),reportBox=document.querySelector("#report-box"),sendButton=document.getElementById("sender");return[{element:numbersBox,element2:numberBoxTitle,child:numbersBoxNavigationContainer},{element:messageBox,child:messageBoxNavigationContainer,element2:messageBoxTitle,element6:document.querySelector(".tooltip-popup-container")},{element:actionsButtonContainer,child:buttonsBoxNavigationContainer,element3:reportBox,element5:sendButton}]}function highlightIndexedSection(index){elementsToBeHighlighted().forEach((element,i)=>{index==i?(element.element.classList.add("focus_element"),element.element2?.classList.add("title_focus"),element.element3?.classList.add("reduce_opacity"),element.element4?.classList.add("reduce_opacity"),element.element5?.classList.add("focus_border"),element.element6?.classList.add("display_none_class"),element.child.forEach(child=>{child.hidden=!1})):(element.element.classList.remove("focus_element"),element.element2?.classList.remove("title_focus"),element.element3?.classList.remove("reduce_opacity"),element.element4?.classList.remove("reduce_opacity"),element.element5?.classList.remove("focus_border"),element.element6?.classList.remove("display_none_class"),element.child.forEach(child=>{child.hidden=!0}))});const tooltipContainer=document.querySelector(".tooltip-popup-container");tooltipContainer&&(1==index||2==index?tooltipContainer.classList.add("display_none_class"):tooltipContainer.classList.remove("display_none_class"))}function scrollToSection(index){let currentSection=null;0==index?window.scrollTo({top:0,behavior:"smooth"}):currentSection=1==index?document.querySelector(".message-box"):document.querySelector(".action_buttons_div"),currentSection&&currentSection.scrollIntoView({behavior:"smooth"})}function startNavigationTour(){let index=0;const backgroundOverlay=document.querySelector(".background_overlay");if(backgroundOverlay){backgroundOverlay.hidden=!1;const navigationButtons=document.querySelector(".how_to_use_buttons"),prev_button=document.querySelector(".how_to_use_left"),next_button=document.querySelector(".how_to_use_right");navigationButtons&&(navigationButtons.style.display="flex",navigationButtons.hidden=!1,prev_button.style.display="none",prev_button.hidden=!0),scrollToSection(index),highlightIndexedSection(index),prev_button.addEventListener("click",()=>{index--,index=Math.max(Number(index),0),highlightIndexedSection(index),0==index&&(prev_button.hidden=!0,prev_button.style.display="none"),next_button.innerHTML='<span>Next</span><img src="logo/pro-arrow-right.png" alt="left_arrow">',scrollToSection(index)}),next_button.addEventListener("click",()=>{if(index++,index>2)return index=0,backgroundOverlay.hidden=!0,navigationButtons.hidden=!0,navigationButtons.style.display="none",next_button.innerHTML='<span>Next</span><img src="logo/pro-arrow-right.png" alt="left_arrow">',highlightIndexedSection(3),void scrollToSection(0);highlightIndexedSection(index),2==index&&(next_button.innerHTML="<span>Close</span>"),prev_button.hidden=!1,prev_button.style.display="flex",scrollToSection(index)})}}function startNavigationTourOnFirstVisit(){const navigationInterval=setInterval(async()=>{const numbersBox=document.querySelector(".numbers-box");translatedSendObj=await fetchTranslations(sendObj),numbersBox&&(clearInterval(navigationInterval),chrome.storage.local.get(["no_of_visit"],function(res){1==res.no_of_visit&&(driver(translatedSendObj).drive(),removeHighlightTour())}))},500)}function getCurrentTimein24HourFormat(){let now=new Date,hours=now.getHours(),minutes=now.getMinutes();return hours=hours<10?"0"+hours:hours,minutes=minutes<10?"0"+minutes:minutes,`${hours}:${minutes}`}function getCurrentDate(){let now=new Date,year=now.getFullYear(),month=now.getMonth()+1,day=now.getDate();return month=month<10?"0"+month:month,day=day<10?"0"+day:day,`${year}-${month}-${day}`}function showScheduleExpiredPopup(campaign,index){const container=document.querySelector(".schedule_expired_popup_container");container&&document.body.removeChild(container);const schedulePopupContainer=document.createElement("div");schedulePopupContainer.className="schedule_expired_popup_container",schedulePopupContainer.innerHTML=`<div class="schedule_popup_title">\n    <img src="logo/pro-clock.png" alt="" />\n    <p>Reminder: Scheduled campaign not sent</p>\n    </div>\n    <div class="schedule_popup_content">\n    <p>Your campaign scheduled at <span class="schedule_date_time">${formatScheduleDate(campaign.schedule_date)} ${convertTo12Hour(campaign.schedule_time)}</span> <br /> is not send.</p>\n    <div class="schedule_popup_buttons_container">\n                <button id="send_schedule_btn" class="CtaBtn" style="background:#fff; color:#009a88; border:2px solid #009a88">Send now</button>\n                <button id="reschedule_btn" class="CtaBtn" style="background:#009a88; color:#fff; border: 2px solid #fff">Reschedule</button>\n                <button id="delete_schedule_btn" class="CtaBtn" style="color:red; border:2px solid red; background:#fff">Delete</button>\n            </div>\n        </div>\n        <div class="popup-footer">\n            <div class="popup-footer-container">\n                <div class="logo-div">\n                    <img class="logo-icon" src="logo/pro-logo-img.png" alt="Logo"/>\n                    <img class="logo-text" src="logo/pro-logo-text.png" alt="Logo Text"/>\n                </div>\n                <div class="contact-div">\n                    <p>Any questions?</p>\n                    <a class="handle_help_btn CtaBtn">Contact Support</a>\n                </div>\n            </div>\n        </div>\n        `,document.body.appendChild(schedulePopupContainer);const backgroundOverlay=document.querySelector(".background_overlay");backgroundOverlay&&(backgroundOverlay.hidden=!1);const sendScheduleBtn=document.getElementById("send_schedule_btn"),rescheduleBtn=document.getElementById("reschedule_btn"),deleteScheduleBtn=document.getElementById("delete_schedule_btn");sendScheduleBtn.addEventListener("click",()=>{sendMessageToBackground(campaign),window.close()}),rescheduleBtn.addEventListener("click",()=>{chrome.storage.local.get(["scheduled_campaigns"],function(res){const scheduledCampaigns=res.scheduled_campaigns||[];scheduledCampaigns.splice(index,1),chrome.storage.local.set({scheduled_campaigns:scheduledCampaigns}),backgroundOverlay.hidden=!0,document.body.removeChild(schedulePopupContainer);const schedule_checkbox=document.getElementById("schedule_checkbox");schedule_checkbox&&(schedule_checkbox.checked=!0,document.getElementById("schedule").hidden=!1,document.getElementById("sender").hidden=!0,document.querySelector("#schedule_day_div").style.display="flex",document.querySelector("#schedule_time_div").style.display="flex")})}),deleteScheduleBtn.addEventListener("click",()=>{chrome.storage.local.get(["scheduled_campaigns"],function(res){const scheduledCampaigns=res.scheduled_campaigns||[];scheduledCampaigns.splice(index,1),chrome.storage.local.set({scheduled_campaigns:scheduledCampaigns}),backgroundOverlay.hidden=!0,document.body.removeChild(schedulePopupContainer)})})}async function renderSelectedItems(nameFiltersString=""){const items="groups"===messageToggleSwitchValue?allGroups:allContacts;let currentBatch=0;const displayBox=document.querySelector(".groups_display_box");let selectedArray="groups"===messageToggleSwitchValue?groups_selected:contacts_selected;""!==nameFiltersString.trim()?(selectedArray=[],displayBox.innerHTML=""):(selectedArray.length,displayBox.innerHTML="");const nameFilters=nameFiltersString.split(",").map(name=>name.trim().toLowerCase());(nameFilters.length>0?items.filter(item=>nameFilters.some(filter=>item.name.toLowerCase()===filter)):[]).forEach(item=>{selectedArray.includes(item.id._serialized)||selectedArray.push(item.id._serialized)}),"groups"===messageToggleSwitchValue?groups_selected=selectedArray:contacts_selected=selectedArray,requestAnimationFrame(function renderBatch(){const fragment=document.createDocumentFragment();for(let i=100*currentBatch;i<Math.min(selectedArray.length,100*(currentBatch+1));i++){const itemId=selectedArray[i],item=items.find(item=>item.id._serialized===itemId);if(!item)continue;const span=document.createElement("span");span.className="group_tag CtaBtn",span.id=item.objId,span.setAttribute("data-id-field",item.id._serialized),span.innerHTML=`\n                <span class="group">${item.name}</span>\n                <img class="delete_group_tag" src="./logo/pro-closeBtn.png" title="Remove ${"groups"===messageToggleSwitchValue?"Group":"Contact"}">\n            `,fragment.appendChild(span)}displayBox.appendChild(fragment),currentBatch++,100*currentBatch<selectedArray.length&&requestAnimationFrame(renderBatch)}),chrome.storage.local.set({["groups"===messageToggleSwitchValue?"groups_selected":"contacts_selected"]:selectedArray}),nameFilters.length>0&&handleDeleteBin()}function updateGroupBoxDisplay(){const boxLabel=document.querySelector("#box_label"),template_btn=document.querySelector("#campaign-save-icon-items"),displayBox=document.querySelector(".groups_display_box"),search=document.querySelector(".search_group_input"),boxName=document.querySelector(".selector-box-name");boxLabel.innerHTML=`Select ${messageToggleSwitchValue} to message`,template_btn.setAttribute("title",`Save ${String(messageToggleSwitchValue).charAt(0).toUpperCase()+String(messageToggleSwitchValue).slice(1)}`),boxName.innerHTML=`Campaign ${String(messageToggleSwitchValue).charAt(0).toUpperCase()+String(messageToggleSwitchValue).slice(1)}`,search.placeholder=`Search ${messageToggleSwitchValue} by name`,displayBox.innerHTML=`<p style="color:gray;font-size:13px;margin:0px;">Select ${messageToggleSwitchValue} from the dropdown . . .</p>`,("groups"===messageToggleSwitchValue&&groups_selected.length>0||"contacts"===messageToggleSwitchValue&&contacts_selected.length>0)&&renderSelectedItems(),handleDeleteBin(),"labels"===messageToggleSwitchValue&&(showLabelsDropdown(),labels_selected.length>0&&renderSelectedLabels())}function showLabelsDropdown(){const itemsContainer=document.querySelector("#groups_container");if(itemsContainer.innerHTML="",!allLabels||0===allLabels.length)return itemsContainer.innerHTML='<p style="color:gray;font-size:13px;margin:0px;">No labels available. Please ensure WhatsApp Web is open and labels are created.</p>',void console.warn("No labels available in allLabels");const containerHtml=allLabels.filter(label=>!labels_selected.includes(label.id)).map(label=>`\n      <div class="dropdown-item" id="label_${label.id}" data-id-field="${label.id}" style="display: flex; align-items: center; padding: 8px;">\n        <span style="flex: 1;">${label.name}</span>\n        <span style="width: 12px; height: 12px; border-radius: 50%; background-color: ${label.color||"#999"}; display: inline-block;"></span>\n      </div>\n    `).join("");itemsContainer.innerHTML=containerHtml;const searchInput=document.querySelector(".search_group_input");searchInput&&searchInput.addEventListener("input",function(){const inputValue=this.value.toLowerCase();document.querySelectorAll("#groups_container .dropdown-item").forEach(item=>{item.innerText.toLowerCase().includes(inputValue)?item.style.display="flex":item.style.display="none"})}),document.querySelectorAll("#groups_container .dropdown-item").forEach(item=>{item.addEventListener("click",function(){const labelId=this.getAttribute("data-id-field");this.innerText.trim();labels_selected.includes(labelId)||(labels_selected.push(labelId),chrome.storage.local.set({labels_selected}),showLabelsDropdown(),renderSelectedLabels(),handleDeleteBin())})})}function renderSelectedLabels(){const displayBox=document.querySelector(".groups_display_box");if(0===labels_selected.length)return void(displayBox.innerHTML='<p style="color:gray;font-size:13px;margin:0px;">Select labels from the dropdown . . .</p>');let htmlContent="";labels_selected.forEach(labelId=>{const label=allLabels.find(l=>l.id===labelId);label&&(htmlContent+=`<span class="group_tag CtaBtn" id="label_tag_${label.id}" data-id-field="${label.id}" style="margin: 4px;">\n        <span class="group">${label.name}</span>\n        <img class="delete_group_tag" src="./logo/pro-closeBtn.png" title="Remove Label" style="cursor: pointer;">\n      </span>`)}),displayBox.innerHTML=htmlContent,document.querySelectorAll(".groups_display_box .group_tag").forEach(tag=>{const deleteBtn=tag.querySelector(".delete_group_tag");deleteBtn&&deleteBtn.addEventListener("click",function(e){e.stopPropagation();const labelId=tag.getAttribute("data-id-field");tag.querySelector(".group").innerText;labels_selected=labels_selected.filter(id=>id!==labelId),chrome.storage.local.set({labels_selected}),showLabelsDropdown(),renderSelectedLabels()})})}function toggleSendMessageToInput(selectedValue){messageToggleSwitchValue=selectedValue,chrome.storage.local.set({send_messages_to:messageToggleSwitchValue}),"numbers"===messageToggleSwitchValue?(document.querySelector(".numbers-box").style.display="revert",document.querySelector(".groups_box").style.display="none",csv_data&&csv_data.length>0&&(document.querySelector(".customize_container").style.display="flex")):(document.querySelector(".numbers-box").style.display="none",document.querySelector(".groups_box").style.display="flex",document.querySelector(".customize_container").style.display="none",updateGroupBoxDisplay())}function getTodayDate(){let today=new Date,dd=String(today.getDate()).padStart(2,"0"),mm=String(today.getMonth()+1).padStart(2,"0");return today.getFullYear()+"-"+mm+"-"+dd}function dateDiffInDays(date1,date2){const[year1,month1,day1]=date1.split("-").map(Number),[year2,month2,day2]=date2.split("-").map(Number),d1=new Date(year1,month1-1,day1),d2=new Date(year2,month2-1,day2),diffTime=Math.abs(d2-d1);return Math.ceil(diffTime/864e5)}function formatToIsoDate(date){return`${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`}function convertCSVtoExcel(csvFile){return new Promise((resolve,reject)=>{Papa.parse(csvFile,{complete:function(result){try{const worksheet=XLSX.utils.json_to_sheet(result.data),workbook=XLSX.utils.book_new();XLSX.utils.book_append_sheet(workbook,worksheet,"Sheet 1");const parsedData=XLSX.utils.sheet_to_json(worksheet,{header:1,raw:!0});resolve(parsedData)}catch(error){reject(error)}},header:!0,error:function(error){reject(error)}})})}function disableNumberTimeGapInput(type="random"){const sliderTimeGapSec=document.querySelector("#slider_time_gap_sec"),numberTimeInput=document.querySelector("#time_gap_sec"),randomLabelText=document.querySelector("#random_label_text"),customRangeInputs=document.getElementById("custom_range_inputs"),shouldDisableFixed="sec"==type||"random_custom"==type,shouldDisableRandom="random"==type||"random_custom"==type;sliderTimeGapSec&&(sliderTimeGapSec.disabled=shouldDisableFixed),numberTimeInput&&(numberTimeInput.disabled=shouldDisableFixed),randomLabelText&&randomLabelText.classList.toggle("text_color_gray",!shouldDisableRandom),customRangeInputs&&(customRangeInputs.style.display="random_custom"==type?"flex":"none")}function setupRandomCustomRadioHandler(){const radioButton=document.querySelector("#random_custom"),label=document.querySelector("#random_custom_label");radioButton&&label&&(radioButton.removeEventListener("click",handleRandomCustomClick),label.removeEventListener("click",handleRandomCustomClick),radioButton.addEventListener("click",handleRandomCustomClick),label.addEventListener("click",handleRandomCustomClick))}function handleRandomCustomClick(event){return!!isAdvanceFeatureAvailable()||(event.preventDefault(),event.stopPropagation(),sendMessageToBackground({type:"show_premium_popup",feature:"custom_random_time_gap"}),window.close(),!1)}function validateCustomRange(){const fromInput=document.querySelector("#time_gap_from"),toInput=document.querySelector("#time_gap_to"),errorDiv=document.getElementById("custom_range_error");if(!fromInput||!toInput||!errorDiv)return!1;const fromValue=parseInt(fromInput.value),toValue=parseInt(toInput.value);return isNaN(fromValue)||isNaN(toValue)?(errorDiv.textContent="Please enter valid numbers",errorDiv.style.display="block",!1):fromValue>=toValue?(errorDiv.textContent="From value must be less than To value",errorDiv.style.display="block",!1):(errorDiv.style.display="none",!0)}async function handleFreeTrialExpiredUser(last_plan_type,plan_type,expiry_date){try{if(!last_plan_type||!plan_type||!expiry_date)return{isFreeTrialExpiredUser:!1,freeTrialExpiredUserData:{}};if("FreeTrial"==last_plan_type&&"Expired"==plan_type){const daysDiff=dateDiffInDays(formatToIsoDate(new Date),expiry_date);return daysDiff>=freeTrialDuration2&&(freeTrial6MonthsExpired=!0,freeTrial3MonthsExpired=!0),daysDiff>=freeTrialDuration1&&(freeTrial3MonthsExpired=!0),freeTrial6MonthsExpired||freeTrial3MonthsExpired?new Promise((resolve,reject)=>{chrome.storage.local.get(["freeTrialExpiredUserData"],function(res){try{let freeTrialExpiredUserData=res.freeTrialExpiredUserData;freeTrialExpiredUserData?freeTrialExpiredUserData.last_updated_date!=formatToIsoDate(new Date)&&(freeTrialExpiredUserData.sent_count=0,freeTrialExpiredUserData.last_updated_date=formatToIsoDate(new Date),freeTrialExpiredUserData.total_count=freeTrial6MonthsExpired?freeTrialLimit2:freeTrialLimit1):freeTrialExpiredUserData={sent_count:0,last_updated_date:formatToIsoDate(new Date),total_count:freeTrial6MonthsExpired?freeTrialLimit2:freeTrialLimit1},freeTrialExpiredUserData.total_count=freeTrial6MonthsExpired?freeTrialLimit2:freeTrialLimit1,chrome.storage.local.set({freeTrialExpiredUserData},function(){resolve({isFreeTrialExpiredUser:freeTrial3MonthsExpired,freeTrialExpiredUserData})})}catch(error){console.log("ERROR FROM handleFreeTrialExpiredUser",error),resolve({isFreeTrialExpiredUser:!1,freeTrialExpiredUserData:{}})}})}):{isFreeTrialExpiredUser:!1,freeTrialExpiredUserData:{}}}return{isFreeTrialExpiredUser:!1,freeTrialExpiredUserData:{}}}catch(error){return console.log("ERROR FROM handleFreeTrialExpiredUser",error),{isFreeTrialExpiredUser:!1,freeTrialExpiredUserData:{}}}}async function checkIfCanSendCampaign(campaignLength){const{isFreeTrialExpiredUser,freeTrialExpiredUserData}=await handleFreeTrialExpiredUser(last_plan_type,plan_type,expiry_date);return!isFreeTrialExpiredUser||freeTrialExpiredUserData.sent_count+campaignLength<=freeTrialExpiredUserData.total_count}async function showMessgesRemainingDiv(plan_type,last_plan_type,expiry_date){let{isFreeTrialExpiredUser,freeTrialExpiredUserData}=await handleFreeTrialExpiredUser(last_plan_type,plan_type,expiry_date);if(!isFreeTrialExpiredUser)return;const messagesRemainingDiv=document.getElementById("messages_remaining_count_div"),messagesRemainingCount=document.getElementById("messages_remaining_count");if(messagesRemainingDiv){messagesRemainingDiv.hidden=!1;let totalCount=freeTrialExpiredUserData.total_count,remainingCount=totalCount-freeTrialExpiredUserData.sent_count;messagesRemainingCount.innerText=remainingCount+"/"+totalCount}}$(document).ready(async function(){const version=chrome.runtime.getManifest().version;function handleCaption(attLen,attachments,captionForIndividualAttachment,captionAreaHasValue){if($("#caption-checkbox").prop("checked")&&!document.querySelector(".captionCheckBoxDiv")){let captionCheckBoxDiv=document.createElement("div");captionCheckBoxDiv.className="captionCheckBoxDiv",document.querySelector("#caption-section").insertBefore(captionCheckBoxDiv,document.querySelector("#caption-section").children[0])}let captionHtml="",captionTextAreaHtml="";for(let i=0;i<attLen;i++){let file=attachments[i],name=file.name.length>9?file.name.trim().substring(0,9)+"...":file.name.trim();captionHtml+=`\n                <div>\n                    <input type="radio" id="radio${i}" name="attachment" class="attachmentNames" value="${name}" style="margin: 0px 5px; cursor: pointer" ${0==i?"checked":""}>\n                    <label for="radio${i}" style="cursor: pointer">${name}</label>\n                </div>\n            `,captionTextAreaHtml+=`\n                <textarea type="text" id="caption-input${i}" class="caption-input ${0===i?"":"hide"}" \n                        style="width: 434px; font-size: 12px; padding: 7px; resize: none" \n                        placeholder="Type your caption for the file: ${file.name.trim().length>50?file.name.trim().substring(0,50)+"...":file.name.trim()}"\n                ></textarea>\n            `}if(1==attLen&&(captionHtml=""),$(".captionCheckBoxDiv").html(`${captionHtml}`),$(".captionTextAreas").html(`${captionTextAreaHtml}`),captionAreaHasValue)for(let i=0;i<attLen;i++)document.querySelector(`#caption-input${i}`)&&captionForIndividualAttachment[i]&&(document.querySelector(`#caption-input${i}`).value=captionForIndividualAttachment[i]);document.querySelectorAll(".attachmentNames").forEach(ele=>{ele.addEventListener("change",()=>{for(let i=0;i<attLen;i++)document.getElementById(`radio${i}`).checked?document.querySelector(`#caption-input${i}`).classList.remove("hide"):document.getElementById(`radio${i}`).classList.contains("hide")||document.querySelector(`#caption-input${i}`).classList.add("hide")})}),document.querySelectorAll(".caption-input").forEach(ele=>{ele.addEventListener("input",async()=>{var eleId=ele.id.substring(ele.id.search(/\d/));let captionForIndividualAttachment=await new Promise(resolve=>{chrome.storage.local.get(["captionForIndividualAttachment"],res=>{resolve(res.captionForIndividualAttachment)})});captionForIndividualAttachment[eleId]=ele.value,chrome.storage.local.set({captionForIndividualAttachment})})})}async function showAttachments(){$("#attachments-container").html('<span style="margin-right:10px">Fetching showAttachments...</span>');let attachments=await new Promise(resolve=>{chrome.storage.local.get(["attachmentsData"],res=>{resolve(res.attachmentsData||[])})}),showAllAttachments=await new Promise(resolve=>{chrome.storage.local.get("showAllAttachments",res=>{resolve(res.showAllAttachments||!1)})});if(attachments.length>0){let attHtml="",attLen=attachments.length,containsMedia=!0,addAttHtml=!0;for(let i=0;i<attLen;i++){let file=attachments[i],addComma=!0,name=file.name.trim();attLen-1==i&&(addComma=!1),attLen<=3?name.length>24/attLen&&(name=name.slice(0,24/attLen)+"..."):i<2?name.length>8&&(name=name.slice(0,8)+"..."):showAllAttachments||(addAttHtml=!1),showAllAttachments&&(name=name.length>7?file.name.trim().slice(0,7)+"...":file.name.trim()),addAttHtml&&addComma?attHtml+=`<span class="attachment-name">${name}<img src="/logo/pro-remove-attachments-icon.png" alt="Remove Icon" id="${i}"/>,</span>`:addAttHtml&&(attHtml+=`<span class="attachment-name">${name}<img src="/logo/pro-remove-attachments-icon.png" alt="Remove Icon" id="${i}"/></span>`)}if(attLen>3&&!showAllAttachments&&(attHtml+=`<span class="show_more" style="margin-right: 5px;">and <span style="text-decoration:underline;">${attLen-2} more</span></span>`),attLen>3&&showAllAttachments&&(attHtml+='<span class="show_less" style="margin-right: 5px;">... <span style=\'text-decoration:underline\'>show less</span></span>'),$("#attachments-container").html(attHtml),showAllAttachments?0==$("#message").val().length?document.querySelector("#attachments-container").style.maxWidth="250px":document.querySelector("#attachments-container").style.maxWidth="333px":(document.querySelector("#attachments-container").style.textDecoration="none",document.querySelector("#attachments-container").style.maxWidth="270px"),document.querySelector("#message").addEventListener("input",()=>{0==$("#message").val().length?document.querySelector("#attachments-container").style.maxWidth="250px":document.querySelector("#attachments-container").style.maxWidth="333px"}),document.querySelectorAll(".attachment-name img").forEach(element=>{element.addEventListener("click",async e=>{let captionForIndividualAttachment=await new Promise(resolve=>{chrome.storage.local.get(["captionForIndividualAttachment"],res=>{resolve(res.captionForIndividualAttachment||[])})});attachments.splice(element.id,1),captionForIndividualAttachment.splice(element.id,1),attachments.length<=3&&chrome.storage.local.set({showAllAttachments:!1}),chrome.storage.local.set({attachmentsData:attachments}),chrome.storage.local.set({captionForIndividualAttachment}),showAttachments()})}),document.querySelector(".show_more")&&document.querySelector(".show_more").addEventListener("click",()=>{chrome.storage.local.set({showAllAttachments:!0}),showAttachments()}),document.querySelector(".show_less")&&document.querySelector(".show_less").addEventListener("click",()=>{document.querySelector("#attachments-container").style.textDecoration="none",chrome.storage.local.set({showAllAttachments:!1}),showAttachments()}),$("#add-attachments").removeClass("contrast-0"),$("#attachment-first-checkbox-section").prop("hidden",0==$("#message").val().trim().length||0==$("#attachments-container").html().trim().length),containsMedia){let captionForIndividualAttachment=await new Promise(resolve=>{chrome.storage.local.get(["captionForIndividualAttachment"],res=>{resolve(res.captionForIndividualAttachment||[])})});$("#add-caption-container").prop("hidden",!1),$("#add-caption-checkbox-section").prop("hidden",!1);let captionAreaHasValue=!1;for(let i=0;i<captionForIndividualAttachment.length;i++){if(0!=captionForIndividualAttachment[i].replace(/\s/g,"").length){$("#caption-checkbox").prop("checked",!0),captionAreaHasValue=!0;break}}toggleCaptionCustomizationInputDiv(),$("#caption-section").prop("hidden",!$("#caption-checkbox").is(":checked")),handleCaption(attLen,attachments,captionForIndividualAttachment,captionAreaHasValue),document.querySelector("#caption-checkbox").addEventListener("change",()=>{handleCaption(attLen,attachments,captionForIndividualAttachment,captionAreaHasValue)}),chrome.storage.local.get(["dsi854","itc856","icu861","tooltip_popup_count"],res=>{let dsi854=res.dsi854;void 0===res.dsi854&&(dsi854=res.tooltip_popup_count||1);let itc856=res.itc856,icu861=res.icu861;![11,14,17,20].includes(dsi854)||itc856||icu861||($(".caption-tooltip").removeClass("hide"),$(".checkbox-section > .add-tooltip-overlay").removeClass("hide"))})}}else $("#attachments-container").html(""),$("#add-attachments").addClass("contrast-0"),$("#add-caption-container").prop("hidden",!0),$("#add-caption-checkbox-section").prop("hidden",!0),$("#attachment-first-checkbox-section").prop("hidden",!0)}function showTemplateSelectorOrSave(){chrome.storage.local.get(["templates"],res=>{let isTextPresent=!1;const text=$("#message").val().trim();(res.templates||[]).forEach(template=>{text===template.message&&(isTextPresent=!0)}),isTextPresent||0==text.length?($("#template-selector").removeClass("hide"),$("#template-save-icon").addClass("hide"),$(".tooltip-popup-content").removeClass("right-side")):($("#template-selector").addClass("hide"),$("#template-save-icon").removeClass("hide"),$(".tooltip-popup-content").addClass("right-side"))})}function wrapSelectedTextOfMessage(ch){const textarea=document.querySelector("#message"),start=textarea.selectionStart,end=textarea.selectionEnd,text=textarea.value;if(start!==end){const selectedText=text.substring(start,end);if(selectedText.startsWith(ch)&&selectedText.endsWith(ch)){const unwrappedText=selectedText.slice(ch.length,-ch.length);textarea.value=text.substring(0,start)+unwrappedText+text.substring(end),textarea.setSelectionRange(start,start+unwrappedText.length)}else{const boldText=`${ch}${selectedText}${ch}`;textarea.value=text.substring(0,start)+boldText+text.substring(end),textarea.setSelectionRange(start,start+boldText.length)}textarea.dispatchEvent(new Event("change",{bubbles:!0}))}}function showTemplates(){$("#templates-container").html(""),chrome.storage.local.get(["templates"],async res=>{let templates=res.templates||[];if(templates.length>0)for(let index=templates.length-1;index>=0;index--)$("#templates-container").append(`\n                    <div class="dropdown-item">\n                    <p id="${index}" class="template-text text">${templates[index].name}</p>\n                     <img id="${index}" class="template-edit btn" src="./logo/pro-edit_icon.png" />\n                    <img id="${index}" class="template-delete btn" src="./logo/pro-template_delete.png" />\n                    </div>`);else $("#templates-container").append(`\n                    <div class="dropdown-item">${await translate("Nothing to show!")}</div>\n                    <div id="create_template_button" class="dropdown-item" style="justify-content:flex-start; gap:10px;font-size:13px;">\n                        <img src="./logo/pro-floppy-disk.png" style="width:18px;"/>\n                        <span>Add Template</span>\n                    </div>\n                `),$("#create_template_button").click(function(){const topPosition=Math.max(0,(window.innerHeight-250)/2+window.pageYOffset)+"px";$(".template-save-popup").css("top",topPosition),$(".template-save-popup-container").removeClass("hide"),$("#template-msg").val($("#message").val().trim()),$("#template-name").val("").focus()});$(".template-text").click(function(){let id=$(this).attr("id"),tempMsg=templates[id].message;$("#message").val(tempMsg),$("#templates-container").addClass("hide"),$("#template-selector").removeClass("active")}),$(".template-delete").click(async function(){let id=$(this).attr("id"),msg=await translate('Are you sure, you want to remove template "TEMPLATE NAME" ?');msg=msg.replace(/"(.*?)"/gi,`"${templates[id].name}"`),confirm(msg)&&(templates.splice(id,1),chrome.storage.local.set({templates}),showTemplates())}),$(".template-edit").click(async function(){!function editTemplate(index){chrome.storage.local.get(["templates"],async res=>{let templates=res.templates,message=templates[index].message,name=templates[index].name;const topPosition=Math.max(0,(window.innerHeight-250)/2+window.pageYOffset)+"px";$(".template-save-popup").css("top",topPosition),$(".template-save-popup-container").removeClass("hide"),$("#template-msg").val(message),$("#template-name").val(name).focus(),$("#edit-template-index").val(index)})}($(this).attr("id"))})})}function showCampaignSelectorOrSave(){chrome.storage.local.get(["campaigns"],res=>{let isCampaignPresent=!1;const numbers=getFilteredNumbers($("#numbers").val());filterCampaignsByType(res.campaigns||[],messageToggleSwitchValue).forEach(campaign=>{numbers===campaign[messageToggleSwitchValue]&&(isCampaignPresent=!0)}),isCampaignPresent||0==numbers.length?($("#campaign-selector").removeClass("hide"),$("#campaign-save-icon").addClass("hide")):($("#campaign-selector").addClass("hide"),$("#campaign-save-icon").removeClass("hide"))})}function helper(){const topPosition=Math.max(0,(window.innerHeight-250)/2+window.pageYOffset)+"px";let popupTitle=document.querySelector(".campaign-title"),popupBtn=document.querySelector(".campaign-btn"),textArea=document.querySelector("#campaign-numbers");"numbers"!==messageToggleSwitchValue?textArea.setAttribute("readonly",!0):textArea.removeAttribute("readonly"),popupTitle.innerHTML=`Save Campaign ${String(messageToggleSwitchValue).charAt(0).toUpperCase()+String(messageToggleSwitchValue).slice(1)}`,popupBtn.innerHTML=`Save Campaign ${String(messageToggleSwitchValue).charAt(0).toUpperCase()+String(messageToggleSwitchValue).slice(1)}`,$(".campaign-save-popup").css("top",topPosition),$(".campaign-save-popup-container").removeClass("hide")}function finalizeCampaignSave(){"numbers"===messageToggleSwitchValue?($("#campaign-selector").removeClass("hide"),$("#campaigns-container").addClass("hide"),$("#campaign-save-icon").addClass("hide")):($("#campaign_selector_groups").removeClass("hide"),$("#campaigns-container-groups").addClass("hide"),$("#campaign-save-icon-items").addClass("hide")),$(".campaign-save-popup-container").addClass("hide"),$("#edit-index").val(""),trackButtonClick("save_campaign_numbers")}function showCampaigns(){const containerSelector={numbers:"#campaigns-container",groups:"#campaigns-container-groups",contacts:"#campaigns-container-groups"}[messageToggleSwitchValue]||"#campaigns-container";$(containerSelector).html(""),chrome.storage.local.get(["campaigns"],async res=>{let campaigns=res.campaigns||[],filteredCampaigns=filterCampaignsByType(campaigns,messageToggleSwitchValue);if(filteredCampaigns.length>0)for(let index=filteredCampaigns.length-1;index>=0;index--)$(containerSelector).append(`\n                        <div class="dropdown-item">\n                            <p id="${index}" class="campaign-name text">${filteredCampaigns[index].name}</p>\n                            <img id="${index}" class="campaign-edit btn ${"numbers"!==messageToggleSwitchValue?"hide":""}" src="./logo/pro-edit_icon.png" />\n                            <img id="${index}" class="campaign-delete btn" src="./logo/pro-template_delete.png" />\n                        </div>`);else $(containerSelector).append(`\n                    <div class="dropdown-item">${await translate("Nothing to show!")}</div>\n                    ${"numbers"===messageToggleSwitchValue?'<div id="create_campaign_button" class="dropdown-item" style="justify-content:flex-start; gap:10px;font-size:13px;">\n                        <img src="./logo/pro-floppy-disk.png" style="width:18px;"/>\n                        <span>Add Campaign</span>\n                    </div>':""}\n                `),$("#create_campaign_button").click(function(){let numbers=getFilteredNumbers($("#numbers").val());const topPosition=Math.max(0,(window.innerHeight-250)/2+window.pageYOffset)+"px";$(".campaign-save-popup").css("top",topPosition),$(".campaign-save-popup-container").removeClass("hide"),$("#campaign-numbers").val(numbers),$("#campaign-name").val(csv_name).focus()});$(".campaign-name").click(function(){let id=$(this).attr("id"),campaignNumbers=filteredCampaigns[id][messageToggleSwitchValue];"numbers"===messageToggleSwitchValue?replaceNumbers(campaignNumbers):renderSelectedItems(campaignNumbers),$(containerSelector).addClass("hide"),"numbers"===messageToggleSwitchValue?$("#campaign-selector").removeClass("active"):$("#campaign_selector_groups").removeClass("active")}),$(".campaign-delete").click(async function(){let id=$(this).attr("id"),msg=await translate('Are you sure, you want to remove campaign "CAMPAIGN NAME"?');msg=msg.replace(/"(.*?)"/gi,`"${filteredCampaigns[id].name}"`),confirm(msg)&&(campaigns=campaigns.filter(campaign=>campaign!==filteredCampaigns[id]),chrome.storage.local.set({campaigns}),showCampaigns())}),$(".campaign-edit").click(async function(){let id=$(this).attr("id");!function editCampaignsNumber(index){chrome.storage.local.get(["campaigns"],async res=>{let campaigns=res.campaigns,numbers=campaigns[index][messageToggleSwitchValue],name=campaigns[index].name;helper(),$("#campaign-numbers").val(numbers),$("#campaign-name").val(name).focus(),$("#edit-index").val(index)})}(campaigns.indexOf(filteredCampaigns[id]))})})}async function translateAll(targetLanguage){let textElements=document.querySelectorAll("[data-translate-text]"),placeholderElements=document.querySelectorAll("[data-translate-placeholder]");chrome.storage.local.get(["defaultLanguageData","translatedCache"],async res=>{let defaultTexts=res.defaultLanguageData.texts,defaultPlaceholders=res.defaultLanguageData.placeholders,cache=res.translatedCache||{};const textPromises=defaultTexts.map(async text=>{if(cache[text]&&cache[text][targetLanguage])return cache[text][targetLanguage];const translatedText=await translateAPI(text);return cache[text]||(cache[text]={}),cache[text][targetLanguage]=translatedText,translatedText}),placeholderPromises=defaultPlaceholders.map(async placeholder=>{if(cache[placeholder]&&cache[placeholder][targetLanguage])return cache[placeholder][targetLanguage];const translatedPlaceholder=await translateAPI(placeholder);return cache[placeholder]||(cache[placeholder]={}),cache[placeholder][targetLanguage]=translatedPlaceholder,translatedPlaceholder}),translatedTexts=await Promise.all(textPromises),translatedPlaceholders=await Promise.all(placeholderPromises);textElements.forEach((ele,index)=>ele.innerText=translatedTexts[index]),placeholderElements.forEach((ele,index)=>ele.placeholder=translatedPlaceholders[index]),chrome.storage.local.set({translatedCache:cache})})}document.getElementById("extension-version").textContent=version,chrome.storage.local.get(["country_info","popup_numbers"],res=>{country_info=res.country_info||{name:"India",name_code:"IN",dial_code:"91"},addCountryCodeSelector(),replaceNumbers(popup_numbers=res.popup_numbers||"")}),$("#numbers-input").on("blur keydown keyup",function(event){if(event.keyCode&&![13,188].includes(event.keyCode))return;const numbers_str=$(this).val();$(this).val(""),addNumberTags(numbers_str)}),$("#numbers-display").on("click",".number",function(){editNumberTag($(this))}),$("#numbers-display").on("click",".delete-number-tag",function(){$(this).parent(".number-tag").remove();let deleted_num=$(this).parent(".number-tag").children().text();for(let i=0;i<csv_data.length;i++)if(csv_data[i][0]&&csv_data[i][0].toString().includes(deleted_num)){csv_data.splice(i,1);break}chrome.storage.local.set({csv_data}),updateNumbersAndDisplay(),toggleUploadExcelText(!0)}),$("#numbers-display").on("click",function(e){const ele=$(e.target);ele&&!ele.is(".number, .delete-number-tag, .number-tag-input")&&$("#numbers-input").focus()}),$("#delete-all-numbers").on("click",async function(){let msg=await translate("Are you sure, you want to delete all numbers?");confirm(msg)&&(replaceNumbers(""),removeNumbers())}),$("#groups_container").on("scroll",function(){const dropdownContainer=document.getElementById("groups_container");let visibleElementsCount=$("#groups_container .dropdown-item:visible").length;"groups"===messageToggleSwitchValue&&allGroups.length-groups_selected.length===visibleElementsCount?lastScrollPosition=dropdownContainer.scrollTop:"contacts"===messageToggleSwitchValue&&allContacts.length-contacts_selected.length===visibleElementsCount&&(lastScrollPosition_contacts=dropdownContainer.scrollTop)}),$("#delete-all").on("click",async function(){let itemType="groups"===messageToggleSwitchValue?"groups":"labels"===messageToggleSwitchValue?"labels":"contacts",msg=await translate(`Are you sure, you want to delete all ${itemType}?`);confirm(msg)&&("groups"===messageToggleSwitchValue?(groups_selected=[],chrome.storage.local.set({groups_selected})):"labels"===messageToggleSwitchValue?(labels_selected=[],chrome.storage.local.set({labels_selected})):(contacts_selected=[],chrome.storage.local.set({contacts_selected})),updateGroupBoxDisplay())}),$("#select_all_text").on("click",function(){document.getElementById("select-all").checked=!0}),$(".select_all").on("click",function(){document.getElementById("select-all").checked&&(!fetching&&handleSelectAll(),handleDeleteBin(),showGroupsCampaignSelectorOrSave())}),$("#invalid-numbers").on("click",function(){const topPosition=Math.max(0,(window.innerHeight-250)/2+window.pageYOffset)+"px";$(".invalid-numbers-popup").css("top",topPosition),$(".invalid-numbers-popup-container").removeClass("hide");const invalidCount=$(".number-tag.invalid").length;$("#popup-invalid-count").text(invalidCount)}),$(".invalid-numbers-popup-close-button").on("click",function(){$(".invalid-numbers-popup-container").addClass("hide")}),$("#remove-all-invalid").on("click",function(){!function getIndexOfInvalidNumbers(){let index=[];$(".number-tag.invalid").each(function(){index.push($(this).index())});let new_data=csv_data.filter((item,i)=>!index.includes(i-1));csv_data=new_data,chrome.storage.local.set({csv_data:new_data})}(),$(".number-tag.invalid").remove(),$(".invalid-numbers-popup-container").addClass("hide"),updateNumbersAndDisplay()}),$("#download-all-invalid").on("click",function(){const rows=[["Invalid Number","Reason"]];$(".number-tag.invalid").each(function(){const number=country_info.dial_code+$(this).find(".number").text(),reason=$(this).find(".invalid-reason").text();rows.push([number,reason])}),download_csv(rows,"Invalid Numbers"),$(".invalid-numbers-popup-container").addClass("hide")}),showAttachments(),$("#select-attachments").change(async function(){const selAttachmentsFileList=$(this).get(0).files;let selAttachments=Array.from(selAttachmentsFileList);if(trackEvent("add_attachments",selAttachments.length),selAttachments.length+$("#attachments-container .attachment-name").length>1&&!isAdvanceFeatureAvailable())return selAttachments=[],sendMessageToBackground({type:"show_advance_popup",feature:"multiple_attachments"}),void window.close();trackEvent("add_attachments_premium",selAttachments.length),$("#attachments-container").html('<span style="margin-right:10px">Fetching jsgfsjfgsjfgsjfg...</span>');let attachmentsData=await new Promise(resolve=>{chrome.storage.local.get(["attachmentsData"],res=>{let dataArr=res.attachmentsData||[],l=dataArr.length;!async function validateAttachments(attachments){if(0==attachments.length)return!1;if(attachments.length>7){let msg=await translate("Maximum 7 files can be send at a time.");return alert(msg),!1}let isValid=!0;return attachments.every(async file=>{if("application/pdf"==file.type&&file.size>22e6||"application/pdf"!=file.type&&file.size>16e6){const size=file.size/1e6;let msg=await translate(`${file.name} size is too large, [ file size: ${size} MB]. Maximum size recommended: 16MB`);alert(msg),$("#select-attachments").val(""),isValid=!1}return isValid}),isValid}(selAttachments)?resolve(dataArr):(selAttachments.forEach(async file=>{await function dataURItoBlob(file){return new Promise((response,reject)=>{const fr=new FileReader;fr.readAsDataURL(file),fr.onload=()=>response(fr.result),fr.onerror=err=>reject(err)})}(file).then(async blob=>{dataArr.push({name:file.name,data:JSON.stringify(blob)}),dataArr.length-l===selAttachments.length&&resolve(dataArr)})}),chrome.storage.local.get(["attachmentsData"],res=>{a=res.attachmentsData||[]}))})});await chrome.storage.local.set({attachmentsData}),await showAttachments(),$(this).val("")}),$("#add-attachments").click(function(){chrome.storage.local.get(["fva853","facc859"],res=>{0==res.facc859&&chrome.storage.local.set({facc859:1}),1==res.fva853?($(".tooltip-container ").addClass("hide"),$("#add-attachments").addClass("contrast-0"),document.getElementById("help_popup").style.display="block"):isLinux?(sendMessageToBackground({type:"add_attachments"}),window.close()):$("#select-attachments").click()})}),$("#how_to_send_messages_to_groups").click(async function(){trackButtonClick("how_to_send_messages_to_groups"),translatedGroupMsgObj=await fetchTranslations(groupMsgObj),"groups"!==messageToggleSwitchValue&&document.querySelector("#message_type_groups").click(),driver(translatedGroupMsgObj).drive(),removeHighlightTour()}),$("#how_to_send_messages_to_contacts").click(async function(){trackButtonClick("how_to_send_messages_to_contacts"),translatedContactMsgObj=await fetchTranslations(contactMsgObj),"contacts"!==messageToggleSwitchValue&&document.querySelector("#message_type_contact").click(),driver(translatedContactMsgObj).drive(),removeHighlightTour()}),$("#how_to_send_customized_messages").click(async function(){trackButtonClick("how_to_send_customized_messages"),translatedCustomObj=await fetchTranslations(customizationObj),translatedCustomObj.steps[1].popover.onNextClick=()=>{document.querySelector(".upload_excel_text").click(),$("#csv").on("change",function(e){driver(translatedCustomObj).moveNext()})},"numbers"!==messageToggleSwitchValue&&document.querySelector("#message_type_numbers").click(),customization_obj=!0,driver(translatedCustomObj).drive(),removeHighlightTour()}),$("#how_to_send_attachments").click(async function(){trackButtonClick("how_to_send_attachments"),translatedAttachments=await fetchTranslations(attachmentObj),translatedAttachments.steps[2].popover.onNextClick=()=>{attachment_obj=!0;const fileInput=document.querySelector("#select-attachments");fileInput.click(),fileInput.addEventListener("change",()=>{driver(translatedAttachments).moveNext()},{once:!0})},"numbers"!==messageToggleSwitchValue&&document.querySelector("#message_type_numbers").click(),driver(translatedAttachments).drive(),removeHighlightTour()}),$("#how_to_export_unsaved_contacts").click(function(){trackButtonClick("how_to_export_unsaved_contacts"),removeHighlightTour(),sendMessageToBackground({type:"unsaved_contacts_demo"})}),$("#caption-checkbox").change(function(){$("#caption-section").prop("hidden",!$(this).is(":checked"));$(this).is(":checked");toggleCaptionCustomizationInputDiv(),$("#caption-checkbox").is(":checked")&&chrome.storage.local.get(["premiumUsageObject"],function(result){if(void 0!==result.premiumUsageObject){let updatedPremiumUsageObject={...result.premiumUsageObject,caption:!0};chrome.storage.local.set({premiumUsageObject:updatedPremiumUsageObject})}}),trackButtonClick("add_caption")}),chrome.storage.local.get(["dsi854","ltod857","id855","tooltip_popup_count"],result=>{let dsi854=result.dsi854;void 0===result.dsi854&&(dsi854=result.tooltip_popup_count||1);const id855=new Date(result.id855).toDateString(),ltod857=result.ltod857?new Date(result.ltod857):null,today=(new Date).toDateString();id855&&today!==id855&&(null!=ltod857&&ltod857.toDateString()===today||(chrome.storage.local.set({ltod857:today}),chrome.storage.local.set({dsi854:dsi854+1}),chrome.storage.local.set({itc856:!1}),dsi854<3&&chrome.storage.local.set({fva853:!0}))),chrome.storage.local.get(["dsi854","itc856"],res=>{let dsi854=res.dsi854,itc856=res.itc856;[1,4,7,10].includes(dsi854)&&!itc856&&($(".tooltip-popup-container").removeClass("hide"),$(".add-tooltip-overlay").removeClass("hide"))})}),$(".close-tooltip").on("click",()=>{$(".tooltip-popup-container").addClass("hide"),$(".caption-tooltip").addClass("hide"),$(".random-custom-tooltip").addClass("hide"),$(".add-tooltip-overlay").addClass("hide"),chrome.storage.local.set({ltod857:(new Date).toDateString()}),chrome.storage.local.set({itc856:!0})}),$(".random-custom-help-icon").on("click",e=>{e.stopPropagation(),$(".random-custom-tooltip").toggleClass("hide")}),$(document).on("click",e=>{$(e.target).closest(".random-custom-tooltip-trigger").length||$(".random-custom-tooltip").addClass("hide")}),$(".random-custom-tooltip").on("click",e=>{e.stopPropagation()}),$(".anti-spam-help-icon").on("click",e=>{e.stopPropagation(),$(".anti-spam-tooltip").toggleClass("hide")}),$(document).on("click",e=>{$(e.target).closest(".anti-spam-tooltip-trigger").length||$(".anti-spam-tooltip").addClass("hide")}),$(".anti-spam-tooltip").on("click",e=>{e.stopPropagation()}),$(".chatbot-help-icon").on("click",e=>{e.preventDefault(),e.stopPropagation(),$(".chatbot-tooltip").toggleClass("hide")}),$(document).on("click",e=>{$(e.target).closest(".chatbot-tooltip-trigger").length||$(".chatbot-tooltip").addClass("hide")}),$(".chatbot-tooltip").on("click",e=>{e.stopPropagation()}),showTemplateSelectorOrSave(),$("#message").on("input click",function(){showTemplateSelectorOrSave(),$("#template-selector").removeClass("active"),$(".tooltip-container ").addClass("hide"),$("#templates-container").addClass("hide"),$("#attachment-first-checkbox-section").prop("hidden",0==$("#message").val().trim().length||0==$("#attachments-container").html().trim().length)}),$("#message").on("keydown",function(event){if(event.ctrlKey||event.metaKey)if(event.shiftKey)switch(event.key.toLowerCase()){case"x":event.preventDefault(),wrapSelectedTextOfMessage("~");break;case"i":event.preventDefault(),wrapSelectedTextOfMessage("`")}else switch(event.key.toLowerCase()){case"b":event.preventDefault(),wrapSelectedTextOfMessage("*");break;case"i":event.preventDefault(),wrapSelectedTextOfMessage("_")}}),$("#format-bold").on("click",()=>wrapSelectedTextOfMessage("*")),$("#format-italic").on("click",()=>wrapSelectedTextOfMessage("_")),$("#format-strikethrough").on("click",()=>wrapSelectedTextOfMessage("~")),$("#format-code").on("click",()=>wrapSelectedTextOfMessage("`")),$("#template-save-icon").click(function(){const topPosition=Math.max(0,(window.innerHeight-250)/2+window.pageYOffset)+"px";$(".template-save-popup").css("top",topPosition),$(".template-save-popup-container").removeClass("hide"),$("#template-msg").val($("#message").val().trim()),$("#template-name").val("").focus()}),$("#save-template-form").submit(function(e){e.preventDefault();const tempName=$("#template-name").val(),tempMessage=$("#template-msg").val(),editIndex=$("#edit-template-index").val();chrome.storage.local.get(["templates"],res=>{let templates=res.templates||[],isTempNameExists=!1;if(""===editIndex)templates.forEach(template=>{template.name===tempName&&(isTempNameExists=!0)}),isTempNameExists?alert(`Template name "${tempName}" already exists!`):templates.push({name:tempName,message:tempMessage});else{const index=parseInt(editIndex);templates[index].name=tempName,templates[index].message=tempMessage}chrome.storage.local.set({templates}),$(".template-save-popup-container").addClass("hide"),$(".template-container").addClass("hide"),$("#template-save-icon").addClass("hide"),$("#template-selector").removeClass("hide"),$(".tooltip-popup-content").removeClass("right-side"),$("#edit-template-index").val(""),trackButtonClick("save_template_message")})}),$("#template-selector").click(function(e){showTemplates(),trackButtonClick("select_template_message"),$(".tooltip-container ").addClass("hide"),$("#templates-container").toggleClass("hide"),$("#template-selector").toggleClass("active")}),$(".template-popup-close-button").click(function(){$(".template-save-popup-container").addClass("hide")}),showCampaignSelectorOrSave(),showGroupsCampaignSelectorOrSave(),$("#numbers").on("click change",function(){showCampaignSelectorOrSave(),$("#campaign-selector").removeClass("active"),$("#campaigns-container").addClass("hide")}),$("#campaign-save-icon").click(function(){let numbers=getFilteredNumbers($("#numbers").val());helper(),$("#campaign-numbers").val(numbers),$("#campaign-name").val(csv_name).focus()}),$("#campaign-save-icon-items").click(function(){let items=getItemsName();helper(),$("#campaign-numbers").val(items),$("#campaign-name").val(csv_name).focus()}),$("#save-campaign-form").submit(function(e){e.preventDefault();const campName=$("#campaign-name").val(),editIndex=$("#edit-index").val();let campData={};switch(messageToggleSwitchValue){case"numbers":campData.numbers=getFilteredNumbers($("#campaign-numbers").val());break;case"groups":campData.groups=getItemsName();break;case"contacts":campData.contacts=getItemsName();break;default:return void alert("Invalid toggle value!")}if(""===editIndex)saveCampaign(campName,campData,success=>{success&&finalizeCampaignSave()});else{updateCampaign(parseInt(editIndex),campName,campData,success=>{success&&finalizeCampaignSave()})}}),$("#campaign-selector").click(function(e){showCampaigns(),$("#campaigns-container").toggleClass("hide"),$("#campaign-selector").toggleClass("active")}),$("#campaign_selector_groups").click(function(e){showCampaigns(),trackButtonClick("select_campaign_numbers"),$("#campaigns-container-groups").toggleClass("hide"),$("#campaign_selector_groups").toggleClass("active")}),$(".campaign-popup-close-button").click(function(){$(".campaign-save-popup-container").addClass("hide")}),$(".invalid-excel-popup-close-button").click(function(){$(".invalid-excel-popup-container").addClass("hide"),unset_csv_styles(),hideCustomizationContainer(),replaceNumbers(""),toggleUploadExcelText(!0)}),$(".template-excel-button").click(function(){$(".invalid-excel-popup-container").addClass("hide"),unset_csv_styles(),hideCustomizationContainer(),replaceNumbers(""),toggleUploadExcelText(!0)}),$("#report-selector").click(function(e){!function showReports(){$("#reports-container").html(""),chrome.storage.local.get(["deliveryReports"],async res=>{let reports=res.deliveryReports||[];if(reports.length>0)for(let index=reports.length-1;index>=0;index--){let reportDate=getReportDateFormat(reports[index].date),reportName=reports[index].name||"Campaign "+(index+1);$("#reports-container").append(`\n                        <div class="dropdown-item">\n                            <p id="${index}" class="report-name text">\n                                <img src="./logo/pro-excel_icon.png"/>\n                                <span style="color: #009A88;">${reportName}</span>\n                                <span style="color: #5D6063;">${reportDate}</span>\n                            </p>\n                            <img id="${index}" class="report-download btn CtaBtn" src="./logo/pro-download_icon.png" />\n                        </div>`)}else $("#reports-container").append(`<div class="dropdown-item">${await translate("Nothing to show!")}</div>`);$(".report-download").click(function(){let id=$(this).prop("id"),reportDataURI=encodeURI(reports[id].data),reportDownloadDate=getReportDateFormat(reports[id].date,!0),reportDownloadName=`${reports[id].name||"Campaign "+(+id+1)} ${reportDownloadDate}.csv`,link=document.createElement("a");link.setAttribute("href",reportDataURI),link.setAttribute("download",reportDownloadName),document.body.appendChild(link),link.click(),trackButtonClick("download_delivery_report")})})}(),trackButtonClick("select_delivery_report"),$("#reports-container").toggleClass("hide"),$("#report-selector").toggleClass("active")}),$(".groups_display_box").click(function(e){e.stopPropagation();const ele=$(e.target);ele&&!ele.is(".delete_group_tag")&&$(".search_group_input").click()}),$(".search_group_input").click(function(){if("contacts"===messageToggleSwitchValue&&(0===allContacts.length||contacts_selected.length===allContacts.length))return;if("groups"===messageToggleSwitchValue&&(0===allGroups.length||groups_selected.length===allGroups.length))return;if("labels"===messageToggleSwitchValue&&(0===allLabels.length||labels_selected.length===allLabels.length))return;document.querySelector(".search_group_input").value="",$("#select-all").prop("checked",!1),"labels"===messageToggleSwitchValue?showLabelsDropdown():showItems("groups"===messageToggleSwitchValue),$("#groups_container").removeClass("hide");const lastPosition="groups"===messageToggleSwitchValue?lastScrollPosition:lastScrollPosition_contacts;$("#groups_container").scrollTop(lastPosition),$(".message-box").addClass("hide_visibility")}),document.addEventListener("click",function(event){const dropdownContainers=document.querySelectorAll(".dropdown-container"),dropdownBoxes=document.querySelectorAll(".dropdown-box"),dropdownButtons=document.querySelectorAll(".dropdown"),groupsSearchBar=document.querySelectorAll(".groups_searchbar");for(let i=0;i<dropdownBoxes.length;i++)dropdownBoxes[i].contains(event.target)||dropdownContainers[i].contains(event.target)||groupsSearchBar[0].contains(event.target)||event.target.classList.contains("dropdown-item")||event.target.classList.contains("dropdown-container")||(dropdownContainers[i].classList.add("hide"),dropdownButtons[i]?.classList.remove("active"),$(".message-box").removeClass("hide_visibility"),document.querySelector(".search_group_input").value="",$("#select-all").prop("checked",!1))}),document.querySelector(".groups_display_box").addEventListener("click",function(event){if(event.target&&event.target.classList.contains("delete_group_tag")){const parentTag=event.target.closest(".group_tag");if(parentTag){let objId=parentTag.id,serizalizeId=parentTag.getAttribute("data-id-field"),isGroup="groups"===messageToggleSwitchValue,selectedArray=isGroup?groups_selected:contacts_selected;selectedArray=selectedArray.filter(item=>item!==serizalizeId),isGroup?groups_selected=selectedArray:contacts_selected=selectedArray,chrome.storage.local.set({[isGroup?"groups_selected":"contacts_selected"]:selectedArray}),handleDeleteBin();const itemElement=document.querySelector(`#group_container #${objId}`);itemElement&&itemElement.classList.remove("hide"),parentTag.remove();const displayBox=document.querySelector(".groups_display_box");0===selectedArray.length&&(displayBox.innerHTML=`<p style="color:gray;font-size:13px;margin:0px;">Select ${isGroup?"groups":"contacts"} from the dropdown . . .</p>`)}}}),function setDefaultLanguageData(){let textElements=document.querySelectorAll("[data-translate-text]"),defaultTexts=Object.values(textElements).map(ele=>ele.innerText),placeholderElements=document.querySelectorAll("[data-translate-placeholder]"),defaultPlaceholders=Object.values(placeholderElements).map(ele=>ele.placeholder);chrome.storage.local.set({defaultLanguageData:{texts:defaultTexts,placeholders:defaultPlaceholders}})}(),function populateLanguageOptions(){let languageNames=new Intl.DisplayNames(["en"],{type:"language"}),selectedLanguageCodes=navigator.languages.map(lang=>lang.split("-")[0]);selectedLanguageCodes=selectedLanguageCodes.filter((value,index,self)=>self.indexOf(value)===index);let languageSelector=document.getElementById("language-selector");languageSelector.innerHTML="",languageSelector.appendChild(createOption("Espa√±ol (Predeterminado)","es")),chrome.storage.local.get(["currentLanguage"],res=>{currentLanguage=res.currentLanguage||"es",translateAll(currentLanguage),selectedLanguageCodes.forEach(language=>{"en"!==language&&languageSelector.appendChild(createOption(languageNames.of(language),language,language===currentLanguage))}),languageSelector.appendChild(createOption("-----------------------","",!1,!0)),allLanguageCodes.forEach(language=>{"en"===language||selectedLanguageCodes.includes(language)||languageSelector.appendChild(createOption(languageNames.of(language),language,language===currentLanguage))})})}(),$("#language-selector").change(function(){currentLanguage=$(this).val(),chrome.storage.local.set({currentLanguage}),translateAll(currentLanguage),trackEvent("translate_language",currentLanguage),sendMessageToBackground({type:"translate_language",language:currentLanguage})})}),showNewDesignReviewButtons(),startNavigationTourOnFirstVisit();const tours=[{id:"use"},{id:"attachments"},{id:"group"},{id:"contact"},{id:"customize"},{id:"unsaved"}];function isFiveDaysPassed(lastDate,currentDate){const last=new Date(lastDate);return(new Date(currentDate)-last)/864e5>=5}function getNextTour(callback){chrome.storage.local.get(["tourState"],result=>{const tourState=result.tourState||{currentTourIndex:0,lastShownDate:null},currentDate=(new Date).toISOString().split("T")[0];if(!tourState.lastShownDate||isFiveDaysPassed(tourState.lastShownDate,currentDate)){const currentTour=tours[tourState.currentTourIndex];tourState.currentTourIndex=(tourState.currentTourIndex+1)%tours.length,tourState.lastShownDate=currentDate,chrome.storage.local.set({tourState},()=>{callback(currentTour,tourState.currentTourIndex-1)})}else chrome.storage.local.set({tourState},()=>{callback(null)})})}function highlightTour(tour,index){let toursChild=Array.from(document.getElementById("tours").children);isTourRunning=!0,document.getElementsByClassName("advance_options_container")[0].classList.add("blur_section"),(index>2||-1===index)&&document.getElementsByClassName("more-btn")[0].click(),toursChild.forEach(tourChild=>{tourChild.classList.contains(tour.id)?tourChild.classList.add("not_blur_child"):tourChild.classList.add("blur_section")})}function removeHighlightTour(){if(console.log(isTourRunning),isTourRunning){let classes="advance_options_container",toursChild=Array.from(document.getElementById("tours").children);document.getElementsByClassName(classes)[0].classList.remove("blur_section"),toursChild.forEach(tourChild=>{tourChild.classList.contains("not_blur_child")?tourChild.classList.remove("not_blur_child"):tourChild.classList.remove("blur_section")}),isTourRunning=!1}}function showTooltip({elementParentClass,text,positionTop,positionBottom,positionLeft,positionRight}){const parentElement=document.querySelector(elementParentClass),tooltip=document.createElement("div");tooltip.className="tooltip_main_container",positionTop&&(tooltip.style.top=positionTop),positionBottom&&(tooltip.style.bottom=positionBottom),positionLeft&&(tooltip.style.left=positionLeft),positionRight&&(tooltip.style.right=positionRight),tooltip.innerHTML=`\n        <div>\n            ${text}\n        </div>\n        <div class="tooltip_arrow"></div>\n    `,parentElement.appendChild(tooltip)}function removeTooltip(){const tooltip=document.querySelector(".tooltip_main_container");tooltip&&tooltip.remove()}function handleShowTooltip(){const elements=[{query:".attach_symbol",hoverElement:"#add-attachments",text:"Add attachment",bottom:"-30px"},{query:".template-box",hoverElement:"#template-save-icon",text:"Save template",bottom:"-30px"},{query:".campaign-box",hoverElement:"#campaign-save-icon",text:"Save numbers",bottom:"-30px"},{query:".upload_excel_box",hoverElement:".upload_excel_box",text:"upload excel",bottom:"-35px"},{query:"#download_template",hoverElement:"#download_template",text:"Download template excel",bottom:"-35px",left:"20px"}];for(let element of elements){const parentElement=document.querySelector(element.query),hoverElement=document.querySelector(element.hoverElement);parentElement&&hoverElement&&(hoverElement.addEventListener("mouseover",()=>{showTooltip({elementParentClass:element.query,text:element.text,positionTop:element.top,positionLeft:element.left,positionRight:element.right,positionBottom:element.bottom})}),hoverElement.addEventListener("mouseout",()=>{removeTooltip()}))}}function initializeMainEmojiPicker(){const fallbackEmojiList=["üòä","üòÇ","‚ù§Ô∏è","üëç","üéâ","üî•","‚ú®","üíØ","üòç","üôè","üòé","ü§î","üò¢","üò°","üò¥","ü§ó","üòò","üòè","ü§ê","üò∂","üôÉ","üòå","üòî","üò™","ü§§","üò∑","ü§í","ü§ï","ü§Æ","ü§¢","ü§û","ü§ü","ü§ò","ü§ô","üëå","‚úåÔ∏è","ü§ö","ü§õ","üëä","üëè","üôå","üëê","ü§≤","ü§ù","ü§ú","ü§õ","ü¶æ","ü¶ø","üëã","üñêÔ∏è","‚úã","üññ","üëå","ü§å","ü§è","‚úåÔ∏è","ü§û","ü´∞","ü§ü","ü§ò","ü§ô","üëç","üëé","‚òùÔ∏è","üëÜ","üëá","üëà","üëâ","üëä","üëè","üôå","üëê","ü§≤","ü§ù","üôè","üíÖ","üí™","ü¶µ","ü¶∂","üëÇ","üëÉ","üß†","ü¶∑","ü¶¥","üåü","‚≠ê","‚ú®","üí´","üå†","üéÜ","üéá","üéâ","üéä","üéà","üéÅ","üéÄ","üéÇ","üç∞","üßÅ","üç™","üç©","üç´","üç¨","üç≠","üçÆ","üçØ","üçº","‚òï","üçµ","üç∂","üçæ","üç∑","üç∏","üçπ","üç∫","üçª","ü•Ç","ü•É","ü•§","üßÉ","üßâ","üßä","ü•¢","üçΩÔ∏è","üç¥","ü•Ñ","üî™","üç≥","üç∂","ü•ò","üç≤","ü•ó","ü•ô","üåÆ","üåØ","ü•™","ü•ô","üßÜ","üå≠","üçî","üçü","üçï","ü•ì","ü•ö","üçó","üçñ","üå≠","üçù","üçú","üç≤","üçõ","üç£","üç±","ü•ü","ü¶™","üç§","üçô","üçö","üçò","üç•","ü•†","ü•Æ","üç¢","üç°","üçß","üç®","üç¶","üç∞","üéÇ","üßÅ","üçÆ","üç≠","üç¨","üç´","üçø","üç©","üç™","üå∞","ü•ú","üçØ","ü•õ","ü•ê","üçû","ü•ñ","ü•®","üßÄ","ü•ö","üç≥","üßà","ü•û","ü•ì","ü•û","üåΩ","üçÖ","üçÜ","ü•ë","ü•¶","ü•¨","ü•í","üå∂Ô∏è","üå±","ü•ï","üßÑ","üßÖ","ü•î","üç†","ü•ê","üçû","ü•ñ","ü•®","üßÄ","ü•ö","üç≥","üßà","ü•û","ü•ì","ü•û"];let emojiData=null,emojiCategories={},currentCategory=null;const emojiPickerBtn=document.getElementById("main_emoji_picker_btn"),emojiContainer=document.getElementById("main_emoji_picker_container");function renderEmojiPicker(){emojiContainer.innerHTML="";const headerContainer=document.createElement("div");headerContainer.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 2px solid #ddd; padding-bottom: 8px;";const tabsContainer=document.createElement("div");tabsContainer.style.cssText="display: block; gap: 5px; overflow-x: auto; flex: 1;",Object.keys(emojiCategories).forEach(category=>{const tab=document.createElement("button");tab.textContent=category,tab.style.cssText=`\n        background: none;\n        border: none;\n        cursor: pointer;\n        padding: 5px 8px;\n        font-size: 12px;\n        white-space: nowrap;\n        transition: all 0.2s ease;\n        ${category===currentCategory?"border-bottom: 2px solid #009a88; font-weight: bold; color: #009a88;":"color: #666;"}\n      `,tab.addEventListener("click",e=>{e.stopPropagation(),currentCategory=category,renderEmojiPicker()}),tabsContainer.appendChild(tab)}),headerContainer.appendChild(tabsContainer);const closeBtn=document.createElement("button");closeBtn.textContent="‚úï",closeBtn.style.cssText="background: none; border: none; cursor: pointer; font-size: 16px; color: #999; padding: 0 4px; transition: color 0.2s ease;",closeBtn.addEventListener("mouseenter",()=>{closeBtn.style.color="#333"}),closeBtn.addEventListener("mouseleave",()=>{closeBtn.style.color="#999"}),closeBtn.addEventListener("click",e=>{e.stopPropagation(),emojiContainer.style.display="none"}),headerContainer.appendChild(closeBtn),emojiContainer.appendChild(headerContainer);const scrollContainer=document.createElement("div");scrollContainer.style.cssText="max-height: 250px; overflow-y: auto; padding-right: 5px;";const emojiGrid=document.createElement("div");emojiGrid.style.cssText="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;";const categoryTitle=document.createElement("div");categoryTitle.textContent=currentCategory,categoryTitle.style.cssText="grid-column: 1 / -1; font-weight: bold; font-size: 12px; padding: 5px 0; color: #009a88; border-bottom: 1px solid #eee; margin-bottom: 5px;",emojiGrid.appendChild(categoryTitle);(emojiCategories[currentCategory]||[]).forEach(item=>{const emojiBtn=document.createElement("button");emojiBtn.textContent=item.emoji,emojiBtn.title=item.description||"",emojiBtn.style.cssText="background: none; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 20px; padding: 5px; transition: all 0.2s ease; height: 32px; display: flex; align-items: center; justify-content: center;",emojiBtn.addEventListener("mouseenter",()=>{emojiBtn.style.backgroundColor="#f0f0f0",emojiBtn.style.transform="scale(1.1)"}),emojiBtn.addEventListener("mouseleave",()=>{emojiBtn.style.backgroundColor="transparent",emojiBtn.style.transform="scale(1)"}),emojiBtn.addEventListener("click",e=>{e.stopPropagation();const textarea=document.getElementById("message"),start=textarea.selectionStart,end=textarea.selectionEnd,text=textarea.value;textarea.value=text.substring(0,start)+item.emoji+text.substring(end),textarea.selectionStart=textarea.selectionEnd=start+item.emoji.length,textarea.focus(),setTimeout(()=>{emojiContainer.style.display="none"},100)}),emojiGrid.appendChild(emojiBtn)}),scrollContainer.appendChild(emojiGrid),emojiContainer.appendChild(scrollContainer)}emojiPickerBtn&&emojiContainer&&(emojiPickerBtn.addEventListener("mouseenter",()=>{emojiPickerBtn.style.backgroundColor="#f0f0f0"}),emojiPickerBtn.addEventListener("mouseleave",()=>{emojiPickerBtn.style.backgroundColor="transparent"}),emojiPickerBtn.addEventListener("click",async event=>{event.stopPropagation();"none"!==emojiContainer.style.display?emojiContainer.style.display="none":(0===Object.keys(emojiCategories).length&&await async function loadEmojiData(){try{const response=await fetch("js/library/emoji-list.json");if(!response.ok)throw new Error("Failed to load emoji list");emojiData=await response.json(),Object.entries(emojiData).forEach(([categoryName,categoryItems])=>{Array.isArray(categoryItems)&&(emojiCategories[categoryName]=categoryItems.filter(item=>item.emoji))}),currentCategory=Object.keys(emojiCategories)[0]}catch(error){emojiCategories={"Frequently Used":fallbackEmojiList.slice(0,50)},currentCategory="Frequently Used"}}(),renderEmojiPicker(),emojiContainer.style.display="block",emojiContainer.style.position="absolute",emojiContainer.style.bottom="-8px",emojiContainer.style.right="-200px",emojiContainer.style.background="white",emojiContainer.style.border="1px solid #ccc",emojiContainer.style.borderRadius="8px",emojiContainer.style.padding="10px",emojiContainer.style.zIndex="10000",emojiContainer.style.width="350px",emojiContainer.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)")}),document.addEventListener("click",e=>{emojiContainer&&emojiPickerBtn&&!emojiContainer.contains(e.target)&&!emojiPickerBtn.contains(e.target)&&(emojiContainer.style.display="none")}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeMainEmojiPicker):initializeMainEmojiPicker();